<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <!-- Primary Meta Tags -->
    <title>Build an AI Route Optimizer | AI Build Guides | Vibe Coding Enthusiast</title>
    <meta name="title" content="Build an AI Route Optimizer | AI Build Guides | Vibe Coding Enthusiast">
    <meta name="description" content="Learn to build an AI-powered delivery route optimization system using Next.js, Mapbox, Supabase with PostGIS, and Claude API. Complete 6-hour advanced guide with real-time tracking.">
    <meta name="keywords" content="route optimization, delivery routing, mapbox, postgis, claude api, logistics software, fleet management, ai development, vibe coding, build guide, tutorial">
    <meta name="author" content="Vibe Coding Enthusiast">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://vibecodingenthusiast.com/guides/logistics-route-optimizer.html">

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="/favicon.png">
    <link rel="apple-touch-icon" href="/favicon.png">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://vibecodingenthusiast.com/guides/logistics-route-optimizer.html">
    <meta property="og:title" content="Build an AI Route Optimizer | AI Build Guides">
    <meta property="og:description" content="Learn to build an AI-powered delivery route optimization system using Next.js, Mapbox, Supabase with PostGIS, and Claude API. Complete 6-hour advanced guide with real-time tracking.">
    <meta property="og:image" content="https://vibecodingenthusiast.com/guides/images/logistics-route-optimizer-og.png">
    <meta property="og:site_name" content="Vibe Coding Enthusiast">
    <meta property="og:locale" content="en_US">
    <meta property="article:published_time" content="2025-01-14">
    <meta property="article:modified_time" content="2025-01-14">
    <meta property="article:author" content="Vibe Coding Enthusiast">
    <meta property="article:section" content="AI Build Guides">
    <meta property="article:tag" content="Logistics">

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https://vibecodingenthusiast.com/guides/logistics-route-optimizer.html">
    <meta name="twitter:title" content="Build an AI Route Optimizer | AI Build Guides">
    <meta name="twitter:description" content="Learn to build an AI-powered delivery route optimization system using Next.js, Mapbox, Supabase with PostGIS, and Claude API. Complete 6-hour advanced guide with real-time tracking.">
    <meta name="twitter:image" content="https://vibecodingenthusiast.com/guides/images/logistics-route-optimizer-og.png">
    <meta name="twitter:creator" content="@vibecodingenthusiast">

    <!-- Schema.org JSON-LD for TechArticle -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "TechArticle",
        "headline": "Build an AI Route Optimizer",
        "description": "Learn to build an AI-powered delivery route optimization system using Next.js, Mapbox, Supabase with PostGIS, and Claude API. Complete 6-hour advanced guide with real-time tracking.",
        "image": "https://vibecodingenthusiast.com/guides/images/logistics-route-optimizer-og.png",
        "author": {
            "@type": "Organization",
            "name": "Vibe Coding Enthusiast",
            "url": "https://vibecodingenthusiast.com"
        },
        "publisher": {
            "@type": "Organization",
            "name": "Vibe Coding Enthusiast",
            "logo": {
                "@type": "ImageObject",
                "url": "https://vibecodingenthusiast.com/favicon.png"
            }
        },
        "datePublished": "2025-01-14",
        "dateModified": "2025-01-14",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https://vibecodingenthusiast.com/guides/logistics-route-optimizer.html"
        },
        "articleSection": "AI Build Guides",
        "keywords": "route optimization, delivery routing, mapbox, postgis, claude api, logistics software",
        "proficiencyLevel": "Advanced",
        "dependencies": "Next.js 14, Mapbox GL, Supabase, PostGIS, Claude API, Vercel",
        "timeRequired": "PT360M"
    }
    </script>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="/styles.css">

    <!-- Guide-Specific Styles -->
    <style>
        /* Reading Progress Bar */
        .reading-progress {
            position: fixed;
            top: 0;
            left: 0;
            width: 0%;
            height: 3px;
            background: linear-gradient(90deg, #f97316, var(--accent-green));
            z-index: 1001;
            transition: width 0.1s ease-out;
        }

        /* Article Header */
        .article-header {
            padding: 140px 0 60px;
            background: linear-gradient(135deg, rgba(249, 115, 22, 0.08) 0%, transparent 50%);
            position: relative;
            overflow: hidden;
        }
        .article-header::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -20%;
            width: 600px;
            height: 600px;
            background: radial-gradient(circle, rgba(249, 115, 22, 0.1) 0%, transparent 70%);
            border-radius: 50%;
            pointer-events: none;
        }

        /* Breadcrumb */
        .breadcrumb {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.875rem;
            color: var(--text-muted);
            margin-bottom: 24px;
            flex-wrap: wrap;
        }
        .breadcrumb a {
            color: var(--text-secondary);
            text-decoration: none;
            transition: color 0.2s ease;
        }
        .breadcrumb a:hover {
            color: #f97316;
        }
        .breadcrumb-separator {
            color: var(--text-muted);
        }
        .breadcrumb-current {
            color: var(--text-primary);
        }

        /* Guide Meta Badges */
        .guide-meta {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }
        .badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 14px;
            border-radius: 50px;
            font-size: 0.8rem;
            font-weight: 500;
        }
        .badge-beginner {
            background: rgba(16, 185, 129, 0.15);
            color: #10b981;
            border: 1px solid rgba(16, 185, 129, 0.3);
        }
        .badge-intermediate {
            background: rgba(245, 158, 11, 0.15);
            color: #f59e0b;
            border: 1px solid rgba(245, 158, 11, 0.3);
        }
        .badge-advanced {
            background: rgba(239, 68, 68, 0.15);
            color: #ef4444;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }
        .badge-time {
            background: rgba(249, 115, 22, 0.15);
            color: #f97316;
            border: 1px solid rgba(249, 115, 22, 0.3);
        }
        .badge-time svg {
            width: 14px;
            height: 14px;
        }

        /* Article Title */
        .article-header h1 {
            font-size: clamp(2rem, 5vw, 3rem);
            font-weight: 800;
            line-height: 1.2;
            margin-bottom: 20px;
            max-width: 900px;
        }
        .article-header .lead {
            font-size: 1.2rem;
            color: var(--text-secondary);
            line-height: 1.7;
            max-width: 700px;
            margin-bottom: 28px;
        }

        /* Orange gradient text override for this guide */
        .article-header .gradient-text {
            background: linear-gradient(135deg, #f97316 0%, #fb923c 50%, #fdba74 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* Share Buttons in Header */
        .share-buttons {
            display: flex;
            gap: 10px;
        }
        .share-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            border-radius: var(--radius-md);
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .share-btn:hover {
            background: var(--bg-secondary);
            color: #f97316;
            border-color: #f97316;
        }
        .share-btn svg {
            width: 18px;
            height: 18px;
        }

        /* Article Layout - Main Content with Sidebar */
        .article-layout {
            display: grid;
            grid-template-columns: 260px 1fr;
            gap: 60px;
            max-width: 1400px;
            margin: 0 auto;
            padding: clamp(32px, 5vw, 60px) clamp(16px, 4vw, 24px);
        }
        @media (max-width: 1100px) {
            .article-layout {
                grid-template-columns: 1fr;
                gap: 40px;
            }
        }

        /* Table of Contents Sidebar */
        .toc-sidebar {
            position: sticky;
            top: 100px;
            height: fit-content;
            max-height: calc(100vh - 140px);
            overflow-y: auto;
        }
        @media (max-width: 1100px) {
            .toc-sidebar {
                position: static;
                background: var(--bg-card);
                border: 1px solid var(--border-color);
                border-radius: var(--radius-lg);
                padding: 24px;
            }
        }
        .toc-title {
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-muted);
            margin-bottom: 16px;
        }
        .toc-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .toc-list li {
            margin-bottom: 8px;
        }
        .toc-list a {
            display: block;
            padding: 8px 12px;
            font-size: 0.875rem;
            color: var(--text-secondary);
            text-decoration: none;
            border-left: 2px solid transparent;
            transition: all 0.2s ease;
            border-radius: 0 var(--radius-sm) var(--radius-sm) 0;
        }
        .toc-list a:hover {
            color: var(--text-primary);
            background: rgba(249, 115, 22, 0.08);
        }
        .toc-list a.active {
            color: #f97316;
            border-left-color: #f97316;
            background: rgba(249, 115, 22, 0.1);
        }
        .toc-list .toc-h3 {
            padding-left: 24px;
            font-size: 0.8125rem;
        }

        /* Article Content */
        .article-content {
            max-width: 800px;
        }
        .article-content h2 {
            font-size: 1.75rem;
            font-weight: 700;
            margin-top: 56px;
            margin-bottom: 20px;
            padding-top: 24px;
            border-top: 1px solid var(--border-color);
        }
        .article-content h2:first-of-type {
            margin-top: 0;
            padding-top: 0;
            border-top: none;
        }
        .article-content h3 {
            font-size: 1.375rem;
            font-weight: 600;
            margin-top: 40px;
            margin-bottom: 16px;
            color: var(--text-primary);
        }
        .article-content p {
            color: var(--text-secondary);
            line-height: 1.8;
            margin-bottom: 20px;
        }
        .article-content ul,
        .article-content ol {
            color: var(--text-secondary);
            line-height: 1.8;
            margin-bottom: 20px;
            padding-left: 24px;
        }
        .article-content li {
            margin-bottom: 8px;
        }

        /* Tech Stack Table */
        .tech-stack-table {
            width: 100%;
            border-collapse: collapse;
            margin: 24px 0 32px;
            font-size: 0.9rem;
        }
        .tech-stack-table thead {
            background: var(--bg-secondary);
        }
        .tech-stack-table th {
            padding: 14px 16px;
            text-align: left;
            font-weight: 600;
            color: var(--text-primary);
            border-bottom: 2px solid var(--border-color);
        }
        .tech-stack-table td {
            padding: 14px 16px;
            border-bottom: 1px solid var(--border-color);
            color: var(--text-secondary);
        }
        .tech-stack-table tbody tr:hover {
            background: rgba(249, 115, 22, 0.04);
        }

        /* Code Blocks */
        .code-block {
            position: relative;
            margin: 24px 0;
            border-radius: var(--radius-lg);
            overflow: hidden;
            background: #1a1b26;
            border: 1px solid var(--border-color);
        }
        .code-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 16px;
            background: rgba(255, 255, 255, 0.05);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        .code-lang {
            font-size: 0.75rem;
            font-weight: 500;
            color: #f97316;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .code-block pre {
            margin: 0;
            padding: 20px 24px;
            overflow-x: auto;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.875rem;
            line-height: 1.7;
            color: #c0caf5;
        }
        .code-block code {
            font-family: inherit;
        }
        .code-copy-btn {
            padding: 6px 12px;
            font-size: 0.75rem;
            font-weight: 500;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: var(--radius-sm);
            color: #a9b1d6;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .code-copy-btn:hover {
            background: rgba(255, 255, 255, 0.15);
            color: #fff;
        }
        .code-copy-btn.copied {
            background: rgba(16, 185, 129, 0.2);
            border-color: rgba(16, 185, 129, 0.4);
            color: #10b981;
        }

        /* Code Syntax Highlighting */
        .code-block .keyword { color: #bb9af7; }
        .code-block .string { color: #9ece6a; }
        .code-block .comment { color: #565f89; font-style: italic; }
        .code-block .function { color: #7aa2f7; }
        .code-block .variable { color: #c0caf5; }
        .code-block .property { color: #73daca; }
        .code-block .number { color: #ff9e64; }

        /* Callout Boxes */
        .callout {
            padding: 20px 24px;
            border-radius: var(--radius-lg);
            margin: 24px 0;
            border-left: 4px solid;
        }
        .callout-tip {
            background: rgba(16, 185, 129, 0.1);
            border-color: #10b981;
        }
        .callout-tip .callout-title { color: #10b981; }
        .callout-warning {
            background: rgba(245, 158, 11, 0.1);
            border-color: #f59e0b;
        }
        .callout-warning .callout-title { color: #f59e0b; }
        .callout-info {
            background: rgba(249, 115, 22, 0.1);
            border-color: #f97316;
        }
        .callout-info .callout-title { color: #f97316; }
        .callout-title {
            font-weight: 600;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .callout p {
            margin: 0;
            color: var(--text-secondary);
        }

        /* Feature Grid */
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin: 24px 0;
        }
        .feature-item {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: 20px;
            text-align: center;
        }
        .feature-icon {
            font-size: 2rem;
            margin-bottom: 12px;
        }
        .feature-item h4 {
            font-size: 1rem;
            margin-bottom: 8px;
            color: var(--text-primary);
        }
        .feature-item p {
            font-size: 0.875rem;
            color: var(--text-muted);
            margin: 0;
        }

        /* Share Section at Bottom */
        .share-section {
            display: flex;
            align-items: center;
            gap: 16px;
            flex-wrap: wrap;
            padding: 32px 0;
            margin-top: 48px;
            border-top: 1px solid var(--border-color);
        }
        .share-label {
            font-weight: 500;
            color: var(--text-secondary);
        }

        /* Related Guides */
        .related-guides {
            margin-top: 64px;
            padding-top: 48px;
            border-top: 1px solid var(--border-color);
        }
        .related-guides-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 24px;
        }
        .related-guides-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 20px;
        }
        .related-guide-card {
            display: block;
            padding: 24px;
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            text-decoration: none;
            transition: all 0.3s ease;
        }
        .related-guide-card:hover {
            border-color: #f97316;
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
        }
        .related-guide-card h4 {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 8px;
        }
        .related-guide-card p {
            font-size: 0.875rem;
            color: var(--text-muted);
            margin: 0;
            line-height: 1.5;
        }

        /* Newsletter Section */
        .newsletter-section {
            margin-top: 64px;
            padding: 40px;
            background: linear-gradient(135deg, rgba(249, 115, 22, 0.1), rgba(16, 185, 129, 0.05));
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            text-align: center;
        }
        .newsletter-section h3 {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 12px;
            margin-top: 0;
        }
        .newsletter-section > p {
            color: var(--text-secondary);
            margin-bottom: 24px;
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
        }
        .newsletter-form {
            display: flex;
            gap: 12px;
            max-width: 440px;
            margin: 0 auto;
        }
        .newsletter-form input[type="email"] {
            flex: 1;
            padding: 14px 18px;
            font-size: 1rem;
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            color: var(--text-primary);
            outline: none;
            transition: border-color 0.2s ease;
        }
        .newsletter-form input[type="email"]:focus {
            border-color: #f97316;
        }
        .newsletter-form input[type="email"]::placeholder {
            color: var(--text-muted);
        }
        .newsletter-form button {
            padding: 14px 28px;
            font-size: 1rem;
            font-weight: 600;
            background: #f97316;
            color: white;
            border: none;
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all 0.2s ease;
            white-space: nowrap;
        }
        .newsletter-form button:hover {
            background: #ea580c;
            transform: translateY(-1px);
        }
        @media (max-width: 520px) {
            .newsletter-form {
                flex-direction: column;
            }
            .newsletter-form button {
                width: 100%;
            }
        }

        /* Image styling */
        .article-content img {
            max-width: 100%;
            height: auto;
            border-radius: var(--radius-lg);
            margin: 24px 0;
            border: 1px solid var(--border-color);
        }

        /* Anchor links */
        .article-content h2 .anchor-link,
        .article-content h3 .anchor-link {
            opacity: 0;
            margin-left: 8px;
            color: var(--text-muted);
            text-decoration: none;
            transition: opacity 0.2s ease;
        }
        .article-content h2:hover .anchor-link,
        .article-content h3:hover .anchor-link {
            opacity: 1;
        }
        .article-content h2 .anchor-link:hover,
        .article-content h3 .anchor-link:hover {
            color: #f97316;
        }

        /* Architecture Diagram */
        .architecture-diagram {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: 32px;
            margin: 24px 0;
            text-align: center;
        }
        .architecture-diagram pre {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.8rem;
            line-height: 1.6;
            color: var(--text-secondary);
            text-align: left;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <a href="#main" class="skip-link">Skip to main content</a>

    <!-- Reading Progress Bar -->
    <div class="reading-progress" id="readingProgress" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" aria-label="Reading progress"></div>

    <!-- Header -->
    <header class="header">
        <nav class="nav container" role="navigation" aria-label="Main navigation">
            <a href="/" class="logo" aria-label="Vibe Coding Enthusiast - Home">
                <img src="/favicon.png" alt="Vibe Coding Enthusiast" class="logo-icon" width="28" height="28">
                <span class="logo-text">VibeCoding<span class="accent">Enthusiast</span></span>
            </a>
            <ul class="nav-links">
                <li><a href="/">Home</a></li>
                <li><a href="/guides/">Guides</a></li>
                <li><a href="/paths/">Paths</a></li>
                <li><a href="/learn/">Learn</a></li>
                <li><a href="/tools/">Tools</a></li>
                <li><a href="/stacks/">Stacks</a></li>
                <li><a href="/#about">About</a></li>
            </ul>
            <div class="nav-actions">
                <a href="/guides/" class="btn btn-primary">Explore Guides</a>
            </div>
            <button class="mobile-menu-btn" aria-label="Toggle menu" aria-expanded="false">
                <span></span><span></span><span></span>
            </button>
        </nav>
    </header>

    <main id="main">
        <!-- Article Header -->
        <section class="article-header">
            <div class="container">
                <!-- Breadcrumb Navigation -->
                <nav class="breadcrumb" aria-label="Breadcrumb">
                    <a href="/">Home</a>
                    <span class="breadcrumb-separator" aria-hidden="true">/</span>
                    <a href="/guides/">Guides</a>
                    <span class="breadcrumb-separator" aria-hidden="true">/</span>
                    <span class="breadcrumb-current" aria-current="page">AI Route Optimizer</span>
                </nav>

                <!-- Guide Meta Badges -->
                <div class="guide-meta">
                    <span class="badge badge-advanced">Advanced</span>
                    <span class="badge badge-time">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                            <circle cx="12" cy="12" r="10"></circle>
                            <polyline points="12 6 12 12 16 14"></polyline>
                        </svg>
                        ~6 hours
                    </span>
                </div>

                <!-- Title -->
                <h1 class="gradient-text">Build an AI Route Optimizer</h1>

                <!-- Description -->
                <p class="lead">Create a delivery route optimization system that uses AI to find the most efficient paths for multi-stop deliveries. Integrates Mapbox for mapping, PostGIS for geospatial queries, and Claude for intelligent route reasoning.</p>

                <!-- Share Buttons -->
                <div class="share-buttons" role="group" aria-label="Share this guide">
                    <button class="share-btn" data-share="twitter" title="Share on Twitter" aria-label="Share on Twitter">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                            <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
                        </svg>
                    </button>
                    <button class="share-btn" data-share="linkedin" title="Share on LinkedIn" aria-label="Share on LinkedIn">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                            <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
                        </svg>
                    </button>
                    <button class="share-btn" data-share="copy" title="Copy link" aria-label="Copy link to clipboard">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                            <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
                            <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
                        </svg>
                    </button>
                </div>
            </div>
        </section>

        <!-- Main Content with TOC Sidebar -->
        <div class="article-layout">
            <!-- Table of Contents Sidebar -->
            <aside class="toc-sidebar" aria-label="Table of contents">
                <div class="toc-title">On this page</div>
                <ul class="toc-list" id="tocList">
                    <noscript>
                        <li><a href="#overview">What We're Building</a></li>
                        <li><a href="#prerequisites">Prerequisites</a></li>
                        <li><a href="#tech-stack">Tech Stack</a></li>
                        <li><a href="#ai-workflow">AI Agent Workflow</a></li>
                        <li><a href="#build-steps">Build Steps</a></li>
                        <li><a href="#common-issues">Common Issues</a></li>
                        <li><a href="#next-steps">Next Steps</a></li>
                    </noscript>
                </ul>
            </aside>

            <!-- Article Content -->
            <article class="article-content">
                <!-- Section: What We're Building -->
                <h2 id="overview">What We're Building</h2>
                <p>In this advanced guide, you'll build a full-featured AI-powered route optimization system for delivery logistics. The application will let dispatchers input multiple delivery points, visualize them on an interactive map, calculate optimal routes, and use Claude AI to provide intelligent reasoning about route decisions.</p>

                <div class="feature-grid">
                    <div class="feature-item">
                        <div class="feature-icon">ğŸ—ºï¸</div>
                        <h4>Interactive Maps</h4>
                        <p>Mapbox GL for real-time visualization</p>
                    </div>
                    <div class="feature-item">
                        <div class="feature-icon">ğŸ¤–</div>
                        <h4>AI Optimization</h4>
                        <p>Claude-powered route reasoning</p>
                    </div>
                    <div class="feature-item">
                        <div class="feature-icon">ğŸ“</div>
                        <h4>Geospatial Data</h4>
                        <p>PostGIS for location queries</p>
                    </div>
                    <div class="feature-item">
                        <div class="feature-icon">ğŸ“Š</div>
                        <h4>Analytics</h4>
                        <p>Distance, time, and cost metrics</p>
                    </div>
                </div>

                <p>The system addresses a real-world logistics challenge: fuel costs account for 30% of operating expenses, and inefficient routing wastes time, money, and increases carbon footprint. Our optimizer will help reduce these costs by finding the most efficient delivery sequences.</p>

                <!-- Section: Prerequisites -->
                <h2 id="prerequisites">Prerequisites</h2>
                <p>Before starting this guide, make sure you have the following:</p>
                <ul>
                    <li><strong>Node.js 18+</strong> installed on your machine</li>
                    <li><strong>Mapbox account</strong> with an access token (free tier available)</li>
                    <li><strong>Supabase account</strong> for database and PostGIS</li>
                    <li><strong>Anthropic API key</strong> for Claude integration</li>
                    <li><strong>Experience with React/Next.js</strong> and TypeScript</li>
                    <li><strong>Basic understanding of geospatial concepts</strong> (coordinates, distance calculation)</li>
                </ul>

                <!-- Section: Tech Stack -->
                <h2 id="tech-stack">Tech Stack Specification</h2>
                <p>Here's the technology stack we'll use for this build:</p>
                <table class="tech-stack-table">
                    <thead>
                        <tr>
                            <th scope="col">Layer</th>
                            <th scope="col">Technology</th>
                            <th scope="col">Why This Choice</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Frontend</td>
                            <td>Next.js 14, Mapbox GL</td>
                            <td>Server components for performance, Mapbox for professional map visualization</td>
                        </tr>
                        <tr>
                            <td>Backend</td>
                            <td>Next.js API Routes</td>
                            <td>Unified codebase, serverless scaling, easy Vercel deployment</td>
                        </tr>
                        <tr>
                            <td>Database</td>
                            <td>Supabase + PostGIS</td>
                            <td>Managed PostgreSQL with native geospatial support for location queries</td>
                        </tr>
                        <tr>
                            <td>AI</td>
                            <td>Claude API</td>
                            <td>Advanced reasoning for route optimization and constraint handling</td>
                        </tr>
                        <tr>
                            <td>Maps</td>
                            <td>Mapbox Directions API</td>
                            <td>Professional routing data with turn-by-turn directions</td>
                        </tr>
                        <tr>
                            <td>Hosting</td>
                            <td>Vercel</td>
                            <td>Zero-config deployment, edge functions, seamless Next.js integration</td>
                        </tr>
                    </tbody>
                </table>

                <div class="architecture-diagram">
                    <pre>
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Next.js 14 Frontend                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   Map View   â”‚  â”‚  Stop List   â”‚  â”‚   Route Analytics    â”‚  â”‚
â”‚  â”‚  (Mapbox GL) â”‚  â”‚   Manager    â”‚  â”‚     Dashboard        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Next.js API Routes                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   /api/      â”‚  â”‚   /api/      â”‚  â”‚      /api/           â”‚  â”‚
â”‚  â”‚   stops      â”‚  â”‚   routes     â”‚  â”‚   optimize           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                 â”‚                     â”‚
          â–¼                 â–¼                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Supabase +     â”‚  â”‚    Mapbox       â”‚  â”‚   Claude API    â”‚
â”‚    PostGIS      â”‚  â”‚  Directions     â”‚  â”‚   (Reasoning)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    </pre>
                </div>

                <!-- Section: AI Agent Workflow -->
                <h2 id="ai-workflow">AI Agent Workflow</h2>
                <p>Here's how to leverage AI tools throughout this build to maximize productivity:</p>

                <h3 id="ai-scaffolding">Project Scaffolding with Claude Code</h3>
                <p>Use Claude Code to scaffold the Next.js project with all necessary configurations for Mapbox, Supabase, and the API structure.</p>

                <div class="code-block">
                    <div class="code-header">
                        <span class="code-lang">Prompt</span>
                        <button class="code-copy-btn" aria-label="Copy code">Copy</button>
                    </div>
                    <pre><code><span class="comment"># Claude Code prompt for project setup</span>
Create a Next.js 14 route optimization app with:
- TypeScript configuration
- Mapbox GL integration with react-map-gl
- Supabase client setup with PostGIS types
- API routes structure for /stops, /routes, /optimize
- Tailwind CSS with a logistics-themed color scheme
- Environment variable templates for all API keys
- Type definitions for DeliveryStop, Route, and Optimization</code></pre>
                </div>

                <h3 id="ai-ui">UI Generation with v0.dev</h3>
                <p>Use v0.dev to rapidly prototype the dashboard components, including the map container, stop list sidebar, and analytics panels.</p>

                <div class="callout callout-tip">
                    <div class="callout-title">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M12 2v4M12 18v4M4.93 4.93l2.83 2.83M16.24 16.24l2.83 2.83M2 12h4M18 12h4M4.93 19.07l2.83-2.83M16.24 7.76l2.83-2.83"/></svg>
                        Pro Tip
                    </div>
                    <p>When using v0.dev for map interfaces, focus on generating the surrounding UI (sidebars, panels, controls) and manually integrate the Mapbox component. v0 excels at layout and styling but map libraries need direct configuration.</p>
                </div>

                <h3 id="ai-debugging">Development with Cursor</h3>
                <p>Use Cursor's AI features to help with Mapbox configuration, PostGIS query optimization, and debugging geospatial calculations. The inline AI assistance is particularly helpful for understanding GeoJSON structures.</p>

                <!-- Section: Build Steps -->
                <h2 id="build-steps">Step-by-Step Build Guide</h2>

                <h3 id="phase-1">Phase 1: Map Interface Setup with Mapbox</h3>
                <p>Start by setting up the Next.js project and integrating Mapbox GL for our interactive map visualization.</p>

                <div class="code-block">
                    <div class="code-header">
                        <span class="code-lang">Terminal</span>
                        <button class="code-copy-btn" aria-label="Copy code">Copy</button>
                    </div>
                    <pre><code><span class="comment"># Create the Next.js project</span>
npx create-next-app@latest route-optimizer --typescript --tailwind --app
cd route-optimizer

<span class="comment"># Install Mapbox and related dependencies</span>
npm install mapbox-gl react-map-gl @mapbox/mapbox-gl-directions
npm install @types/mapbox-gl --save-dev

<span class="comment"># Install Supabase and Anthropic SDK</span>
npm install @supabase/supabase-js @anthropic-ai/sdk

<span class="comment"># Install additional utilities</span>
npm install @turf/turf date-fns zustand</code></pre>
                </div>

                <p>Create the main map component that will display delivery stops and routes:</p>

                <div class="code-block">
                    <div class="code-header">
                        <span class="code-lang">TypeScript - components/DeliveryMap.tsx</span>
                        <button class="code-copy-btn" aria-label="Copy code">Copy</button>
                    </div>
                    <pre><code><span class="string">'use client'</span>;

<span class="keyword">import</span> { useRef, useCallback, useState } <span class="keyword">from</span> <span class="string">'react'</span>;
<span class="keyword">import</span> Map, { Marker, Source, Layer, NavigationControl } <span class="keyword">from</span> <span class="string">'react-map-gl'</span>;
<span class="keyword">import</span> <span class="keyword">type</span> { MapRef, MarkerDragEvent } <span class="keyword">from</span> <span class="string">'react-map-gl'</span>;
<span class="keyword">import</span> <span class="string">'mapbox-gl/dist/mapbox-gl.css'</span>;

<span class="keyword">interface</span> DeliveryStop {
  id: <span class="property">string</span>;
  name: <span class="property">string</span>;
  latitude: <span class="property">number</span>;
  longitude: <span class="property">number</span>;
  priority: <span class="string">'high'</span> | <span class="string">'medium'</span> | <span class="string">'low'</span>;
  timeWindow?: { start: <span class="property">string</span>; end: <span class="property">string</span> };
}

<span class="keyword">interface</span> OptimizedRoute {
  coordinates: [<span class="property">number</span>, <span class="property">number</span>][];
  distance: <span class="property">number</span>;
  duration: <span class="property">number</span>;
  stopOrder: <span class="property">string</span>[];
}

<span class="keyword">interface</span> DeliveryMapProps {
  stops: DeliveryStop[];
  route: OptimizedRoute | <span class="keyword">null</span>;
  onStopDrag: (stopId: <span class="property">string</span>, lat: <span class="property">number</span>, lng: <span class="property">number</span>) => <span class="keyword">void</span>;
  onMapClick: (lat: <span class="property">number</span>, lng: <span class="property">number</span>) => <span class="keyword">void</span>;
}

<span class="keyword">export default function</span> <span class="function">DeliveryMap</span>({ stops, route, onStopDrag, onMapClick }: DeliveryMapProps) {
  <span class="keyword">const</span> mapRef = useRef&lt;MapRef&gt;(<span class="keyword">null</span>);
  <span class="keyword">const</span> [viewState, setViewState] = useState({
    longitude: <span class="number">-122.4</span>,
    latitude: <span class="number">37.8</span>,
    zoom: <span class="number">11</span>
  });

  <span class="keyword">const</span> handleMapClick = useCallback((event: mapboxgl.MapLayerMouseEvent) => {
    <span class="keyword">const</span> { lng, lat } = event.lngLat;
    onMapClick(lat, lng);
  }, [onMapClick]);

  <span class="keyword">const</span> handleMarkerDrag = useCallback((stopId: <span class="property">string</span>) =>
    (event: MarkerDragEvent) => {
      <span class="keyword">const</span> { lng, lat } = event.lngLat;
      onStopDrag(stopId, lat, lng);
    }, [onStopDrag]);

  <span class="comment">// GeoJSON for the route line</span>
  <span class="keyword">const</span> routeGeoJSON = route ? {
    type: <span class="string">'Feature'</span>,
    geometry: {
      type: <span class="string">'LineString'</span>,
      coordinates: route.coordinates
    }
  } : <span class="keyword">null</span>;

  <span class="keyword">return</span> (
    &lt;Map
      ref={mapRef}
      {...viewState}
      onMove={evt => setViewState(evt.viewState)}
      onClick={handleMapClick}
      mapStyle=<span class="string">"mapbox://styles/mapbox/dark-v11"</span>
      mapboxAccessToken={process.env.NEXT_PUBLIC_MAPBOX_TOKEN}
      style={{ width: <span class="string">'100%'</span>, height: <span class="string">'100%'</span> }}
    &gt;
      &lt;NavigationControl position=<span class="string">"top-right"</span> /&gt;

      {<span class="comment">/* Render route line */</span>}
      {routeGeoJSON && (
        &lt;Source id=<span class="string">"route"</span> type=<span class="string">"geojson"</span> data={routeGeoJSON}&gt;
          &lt;Layer
            id=<span class="string">"route-line"</span>
            type=<span class="string">"line"</span>
            paint={{
              <span class="string">'line-color'</span>: <span class="string">'#f97316'</span>,
              <span class="string">'line-width'</span>: <span class="number">4</span>,
              <span class="string">'line-opacity'</span>: <span class="number">0.8</span>
            }}
          /&gt;
        &lt;/Source&gt;
      )}

      {<span class="comment">/* Render delivery stop markers */</span>}
      {stops.map((stop, index) => (
        &lt;Marker
          key={stop.id}
          longitude={stop.longitude}
          latitude={stop.latitude}
          draggable
          onDragEnd={handleMarkerDrag(stop.id)}
        &gt;
          &lt;div className={`
            w-8 h-8 rounded-full flex items-center justify-center
            text-white font-bold text-sm shadow-lg cursor-pointer
            ${stop.priority === <span class="string">'high'</span> ? <span class="string">'bg-red-500'</span> :
              stop.priority === <span class="string">'medium'</span> ? <span class="string">'bg-orange-500'</span> : <span class="string">'bg-green-500'</span>}
          `}&gt;
            {index + <span class="number">1</span>}
          &lt;/div&gt;
        &lt;/Marker&gt;
      ))}
    &lt;/Map&gt;
  );
}</code></pre>
                </div>

                <h3 id="phase-2">Phase 2: Delivery Point Management</h3>
                <p>Set up Supabase with PostGIS for storing and querying delivery locations. Create the database schema and API endpoints for managing stops.</p>

                <div class="code-block">
                    <div class="code-header">
                        <span class="code-lang">SQL - Supabase Migration</span>
                        <button class="code-copy-btn" aria-label="Copy code">Copy</button>
                    </div>
                    <pre><code><span class="comment">-- Enable PostGIS extension</span>
<span class="keyword">CREATE EXTENSION IF NOT EXISTS</span> postgis;

<span class="comment">-- Create delivery stops table</span>
<span class="keyword">CREATE TABLE</span> delivery_stops (
  id UUID <span class="keyword">DEFAULT</span> gen_random_uuid() <span class="keyword">PRIMARY KEY</span>,
  name TEXT <span class="keyword">NOT NULL</span>,
  address TEXT,
  location GEOGRAPHY(Point, <span class="number">4326</span>) <span class="keyword">NOT NULL</span>,
  priority TEXT <span class="keyword">CHECK</span> (priority <span class="keyword">IN</span> (<span class="string">'high'</span>, <span class="string">'medium'</span>, <span class="string">'low'</span>)) <span class="keyword">DEFAULT</span> <span class="string">'medium'</span>,
  time_window_start TIME,
  time_window_end TIME,
  service_duration INTERVAL <span class="keyword">DEFAULT</span> <span class="string">'15 minutes'</span>,
  created_at TIMESTAMPTZ <span class="keyword">DEFAULT</span> NOW(),
  updated_at TIMESTAMPTZ <span class="keyword">DEFAULT</span> NOW()
);

<span class="comment">-- Create index for spatial queries</span>
<span class="keyword">CREATE INDEX</span> idx_delivery_stops_location
<span class="keyword">ON</span> delivery_stops <span class="keyword">USING</span> GIST(location);

<span class="comment">-- Create routes table</span>
<span class="keyword">CREATE TABLE</span> optimized_routes (
  id UUID <span class="keyword">DEFAULT</span> gen_random_uuid() <span class="keyword">PRIMARY KEY</span>,
  stop_ids UUID[] <span class="keyword">NOT NULL</span>,
  stop_order INTEGER[] <span class="keyword">NOT NULL</span>,
  total_distance DECIMAL(<span class="number">10</span>, <span class="number">2</span>),
  total_duration INTERVAL,
  route_geometry GEOGRAPHY(LineString, <span class="number">4326</span>),
  ai_reasoning TEXT,
  created_at TIMESTAMPTZ <span class="keyword">DEFAULT</span> NOW()
);

<span class="comment">-- Function to find nearby stops within radius</span>
<span class="keyword">CREATE OR REPLACE FUNCTION</span> <span class="function">find_nearby_stops</span>(
  center_lat DOUBLE PRECISION,
  center_lng DOUBLE PRECISION,
  radius_meters INTEGER
)
<span class="keyword">RETURNS TABLE</span> (
  id UUID,
  name TEXT,
  distance_meters DOUBLE PRECISION
) <span class="keyword">AS</span> $$
<span class="keyword">BEGIN</span>
  <span class="keyword">RETURN QUERY</span>
  <span class="keyword">SELECT</span>
    ds.id,
    ds.name,
    ST_Distance(
      ds.location::geography,
      ST_SetSRID(ST_MakePoint(center_lng, center_lat), <span class="number">4326</span>)::geography
    ) <span class="keyword">AS</span> distance_meters
  <span class="keyword">FROM</span> delivery_stops ds
  <span class="keyword">WHERE</span> ST_DWithin(
    ds.location::geography,
    ST_SetSRID(ST_MakePoint(center_lng, center_lat), <span class="number">4326</span>)::geography,
    radius_meters
  )
  <span class="keyword">ORDER BY</span> distance_meters;
<span class="keyword">END</span>;
$$ <span class="keyword">LANGUAGE</span> plpgsql;</code></pre>
                </div>

                <p>Create the API route for managing delivery stops:</p>

                <div class="code-block">
                    <div class="code-header">
                        <span class="code-lang">TypeScript - app/api/stops/route.ts</span>
                        <button class="code-copy-btn" aria-label="Copy code">Copy</button>
                    </div>
                    <pre><code><span class="keyword">import</span> { createClient } <span class="keyword">from</span> <span class="string">'@supabase/supabase-js'</span>;
<span class="keyword">import</span> { NextRequest, NextResponse } <span class="keyword">from</span> <span class="string">'next/server'</span>;

<span class="keyword">const</span> supabase = createClient(
  process.env.SUPABASE_URL!,
  process.env.SUPABASE_ANON_KEY!
);

<span class="keyword">export async function</span> <span class="function">GET</span>() {
  <span class="keyword">const</span> { data, error } = <span class="keyword">await</span> supabase
    .from(<span class="string">'delivery_stops'</span>)
    .select(<span class="string">`
      id,
      name,
      address,
      priority,
      time_window_start,
      time_window_end,
      service_duration
    `</span>)
    .order(<span class="string">'created_at'</span>, { ascending: <span class="keyword">false</span> });

  <span class="keyword">if</span> (error) {
    <span class="keyword">return</span> NextResponse.json({ error: error.message }, { status: <span class="number">500</span> });
  }

  <span class="comment">// Fetch coordinates separately (PostGIS returns complex format)</span>
  <span class="keyword">const</span> stopsWithCoords = <span class="keyword">await</span> Promise.all(
    data.map(<span class="keyword">async</span> (stop) => {
      <span class="keyword">const</span> { data: coordData } = <span class="keyword">await</span> supabase
        .rpc(<span class="string">'get_stop_coordinates'</span>, { stop_id: stop.id });
      <span class="keyword">return</span> {
        ...stop,
        latitude: coordData?.[<span class="number">0</span>]?.lat,
        longitude: coordData?.[<span class="number">0</span>]?.lng
      };
    })
  );

  <span class="keyword">return</span> NextResponse.json(stopsWithCoords);
}

<span class="keyword">export async function</span> <span class="function">POST</span>(request: NextRequest) {
  <span class="keyword">const</span> body = <span class="keyword">await</span> request.json();
  <span class="keyword">const</span> { name, address, latitude, longitude, priority, timeWindow } = body;

  <span class="comment">// Insert with PostGIS geography point</span>
  <span class="keyword">const</span> { data, error } = <span class="keyword">await</span> supabase.rpc(<span class="string">'insert_delivery_stop'</span>, {
    p_name: name,
    p_address: address,
    p_lat: latitude,
    p_lng: longitude,
    p_priority: priority || <span class="string">'medium'</span>,
    p_time_start: timeWindow?.start || <span class="keyword">null</span>,
    p_time_end: timeWindow?.end || <span class="keyword">null</span>
  });

  <span class="keyword">if</span> (error) {
    <span class="keyword">return</span> NextResponse.json({ error: error.message }, { status: <span class="number">500</span> });
  }

  <span class="keyword">return</span> NextResponse.json(data, { status: <span class="number">201</span> });
}</code></pre>
                </div>

                <h3 id="phase-3">Phase 3: Route Calculation with Mapbox</h3>
                <p>Integrate Mapbox Directions API to calculate driving routes between delivery stops, including distance and duration estimates.</p>

                <div class="code-block">
                    <div class="code-header">
                        <span class="code-lang">TypeScript - lib/mapbox.ts</span>
                        <button class="code-copy-btn" aria-label="Copy code">Copy</button>
                    </div>
                    <pre><code><span class="keyword">interface</span> Waypoint {
  latitude: <span class="property">number</span>;
  longitude: <span class="property">number</span>;
}

<span class="keyword">interface</span> RouteResult {
  coordinates: [<span class="property">number</span>, <span class="property">number</span>][];
  distance: <span class="property">number</span>; <span class="comment">// meters</span>
  duration: <span class="property">number</span>; <span class="comment">// seconds</span>
  legs: RouteLeg[];
}

<span class="keyword">interface</span> RouteLeg {
  distance: <span class="property">number</span>;
  duration: <span class="property">number</span>;
  summary: <span class="property">string</span>;
}

<span class="keyword">export async function</span> <span class="function">getMapboxRoute</span>(
  waypoints: Waypoint[]
): Promise&lt;RouteResult&gt; {
  <span class="keyword">if</span> (waypoints.length < <span class="number">2</span>) {
    <span class="keyword">throw new</span> Error(<span class="string">'At least 2 waypoints required'</span>);
  }

  <span class="comment">// Format coordinates for Mapbox API: lng,lat;lng,lat;...</span>
  <span class="keyword">const</span> coordinatesString = waypoints
    .map(wp => `${wp.longitude},${wp.latitude}`)
    .join(<span class="string">';'</span>);

  <span class="keyword">const</span> url = <span class="string">`https://api.mapbox.com/directions/v5/mapbox/driving/</span>${coordinatesString}<span class="string">?`</span> +
    <span class="keyword">new</span> URLSearchParams({
      access_token: process.env.MAPBOX_ACCESS_TOKEN!,
      geometries: <span class="string">'geojson'</span>,
      overview: <span class="string">'full'</span>,
      steps: <span class="string">'true'</span>
    });

  <span class="keyword">const</span> response = <span class="keyword">await</span> fetch(url);
  <span class="keyword">const</span> data = <span class="keyword">await</span> response.json();

  <span class="keyword">if</span> (data.code !== <span class="string">'Ok'</span>) {
    <span class="keyword">throw new</span> Error(`Mapbox API error: ${data.message}`);
  }

  <span class="keyword">const</span> route = data.routes[<span class="number">0</span>];

  <span class="keyword">return</span> {
    coordinates: route.geometry.coordinates,
    distance: route.distance,
    duration: route.duration,
    legs: route.legs.map((leg: <span class="keyword">any</span>) => ({
      distance: leg.distance,
      duration: leg.duration,
      summary: leg.summary
    }))
  };
}

<span class="comment">// Calculate distance matrix for optimization</span>
<span class="keyword">export async function</span> <span class="function">getDistanceMatrix</span>(
  waypoints: Waypoint[]
): Promise&lt;<span class="property">number</span>[][]&gt; {
  <span class="keyword">const</span> coordinatesString = waypoints
    .map(wp => `${wp.longitude},${wp.latitude}`)
    .join(<span class="string">';'</span>);

  <span class="keyword">const</span> url = <span class="string">`https://api.mapbox.com/directions-matrix/v1/mapbox/driving/</span>${coordinatesString}<span class="string">?`</span> +
    <span class="keyword">new</span> URLSearchParams({
      access_token: process.env.MAPBOX_ACCESS_TOKEN!,
      annotations: <span class="string">'duration,distance'</span>
    });

  <span class="keyword">const</span> response = <span class="keyword">await</span> fetch(url);
  <span class="keyword">const</span> data = <span class="keyword">await</span> response.json();

  <span class="keyword">return</span> data.durations; <span class="comment">// 2D array of travel times</span>
}</code></pre>
                </div>

                <h3 id="phase-4">Phase 4: AI Optimization Layer (Claude)</h3>
                <p>This is where the magic happens. We use Claude to analyze the delivery constraints, reason about optimal ordering, and provide explanations for route decisions.</p>

                <div class="code-block">
                    <div class="code-header">
                        <span class="code-lang">TypeScript - app/api/optimize/route.ts</span>
                        <button class="code-copy-btn" aria-label="Copy code">Copy</button>
                    </div>
                    <pre><code><span class="keyword">import</span> Anthropic <span class="keyword">from</span> <span class="string">'@anthropic-ai/sdk'</span>;
<span class="keyword">import</span> { NextRequest, NextResponse } <span class="keyword">from</span> <span class="string">'next/server'</span>;
<span class="keyword">import</span> { getDistanceMatrix, getMapboxRoute } <span class="keyword">from</span> <span class="string">'@/lib/mapbox'</span>;

<span class="keyword">const</span> anthropic = <span class="keyword">new</span> Anthropic({
  apiKey: process.env.ANTHROPIC_API_KEY!
});

<span class="keyword">interface</span> DeliveryStop {
  id: <span class="property">string</span>;
  name: <span class="property">string</span>;
  latitude: <span class="property">number</span>;
  longitude: <span class="property">number</span>;
  priority: <span class="string">'high'</span> | <span class="string">'medium'</span> | <span class="string">'low'</span>;
  timeWindow?: { start: <span class="property">string</span>; end: <span class="property">string</span> };
  serviceDuration?: <span class="property">number</span>; <span class="comment">// minutes</span>
}

<span class="keyword">export async function</span> <span class="function">POST</span>(request: NextRequest) {
  <span class="keyword">const</span> { stops, startLocation, constraints } = <span class="keyword">await</span> request.json();

  <span class="comment">// Get distance matrix from Mapbox</span>
  <span class="keyword">const</span> allPoints = [startLocation, ...stops];
  <span class="keyword">const</span> distanceMatrix = <span class="keyword">await</span> getDistanceMatrix(allPoints);

  <span class="comment">// Prepare context for Claude</span>
  <span class="keyword">const</span> stopsContext = stops.map((stop: DeliveryStop, idx: <span class="property">number</span>) => ({
    index: idx + <span class="number">1</span>,
    name: stop.name,
    priority: stop.priority,
    timeWindow: stop.timeWindow || <span class="string">'flexible'</span>,
    serviceDuration: stop.serviceDuration || <span class="number">15</span>
  }));

  <span class="keyword">const</span> matrixContext = distanceMatrix.map((row, i) =>
    `From ${i === <span class="number">0</span> ? <span class="string">'depot'</span> : <span class="string">`stop ${i}`</span>}: ` +
    row.map((duration, j) =>
      `${j === <span class="number">0</span> ? <span class="string">'depot'</span> : <span class="string">`stop ${j}`</span>}=${Math.round(duration / <span class="number">60</span>)}min`
    ).join(<span class="string">', '</span>)
  ).join(<span class="string">'\n'</span>);

  <span class="comment">// Use Claude for intelligent route optimization</span>
  <span class="keyword">const</span> message = <span class="keyword">await</span> anthropic.messages.create({
    model: <span class="string">'claude-sonnet-4-20250514'</span>,
    max_tokens: <span class="number">2048</span>,
    messages: [{
      role: <span class="string">'user'</span>,
      content: <span class="string">`You are a delivery route optimization expert. Analyze these delivery stops and determine the optimal order to minimize total travel time while respecting constraints.

DELIVERY STOPS:
${JSON.stringify(stopsContext, <span class="keyword">null</span>, <span class="number">2</span>)}

TRAVEL TIME MATRIX (in minutes):
${matrixContext}

CONSTRAINTS:
- High priority stops should be visited early in the route
- Respect time windows when specified
- Account for service duration at each stop
- Vehicle starts and ends at depot (index 0)
${constraints?.maxRouteTime ? <span class="string">`- Maximum route duration: ${constraints.maxRouteTime} hours`</span> : <span class="string">''</span>}

Respond with a JSON object containing:
1. "order": array of stop indices in optimal visit order (e.g., [2, 1, 4, 3])
2. "reasoning": explanation of why this order is optimal
3. "estimatedDuration": total route time in minutes
4. "warnings": any concerns or trade-offs in this route

Only respond with valid JSON.`</span>
    }]
  });

  <span class="comment">// Parse Claude's response</span>
  <span class="keyword">const</span> responseText = message.content[<span class="number">0</span>].type === <span class="string">'text'</span>
    ? message.content[<span class="number">0</span>].text
    : <span class="string">''</span>;

  <span class="keyword">let</span> optimization;
  <span class="keyword">try</span> {
    optimization = JSON.parse(responseText);
  } <span class="keyword">catch</span> (e) {
    <span class="comment">// Extract JSON from response if wrapped in markdown</span>
    <span class="keyword">const</span> jsonMatch = responseText.match(/\{[\s\S]*\}/);
    optimization = jsonMatch ? JSON.parse(jsonMatch[<span class="number">0</span>]) : <span class="keyword">null</span>;
  }

  <span class="keyword">if</span> (!optimization) {
    <span class="keyword">return</span> NextResponse.json(
      { error: <span class="string">'Failed to parse optimization result'</span> },
      { status: <span class="number">500</span> }
    );
  }

  <span class="comment">// Get actual route geometry from Mapbox</span>
  <span class="keyword">const</span> orderedWaypoints = [
    startLocation,
    ...optimization.order.map((idx: <span class="property">number</span>) => stops[idx - <span class="number">1</span>]),
    startLocation <span class="comment">// Return to depot</span>
  ];

  <span class="keyword">const</span> routeGeometry = <span class="keyword">await</span> getMapboxRoute(orderedWaypoints);

  <span class="keyword">return</span> NextResponse.json({
    optimizedRoute: {
      stopOrder: optimization.order.map((idx: <span class="property">number</span>) => stops[idx - <span class="number">1</span>].id),
      coordinates: routeGeometry.coordinates,
      distance: routeGeometry.distance,
      duration: routeGeometry.duration,
      legs: routeGeometry.legs
    },
    aiReasoning: optimization.reasoning,
    warnings: optimization.warnings,
    estimatedDuration: optimization.estimatedDuration
  });
}</code></pre>
                </div>

                <div class="callout callout-info">
                    <div class="callout-title">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><circle cx="12" cy="12" r="10"></circle><path d="M12 16v-4M12 8h.01"></path></svg>
                        Why Claude for Route Optimization?
                    </div>
                    <p>Traditional route optimization uses algorithms like TSP solvers, but Claude adds reasoning about soft constraints, priority balancing, and can explain decisions in natural language. This hybrid approach combines algorithmic efficiency with contextual understanding.</p>
                </div>

                <h3 id="phase-5">Phase 5: Real-Time Tracking Simulation</h3>
                <p>Add a simulation layer that shows vehicle progress along the route in real-time, useful for testing and demonstrations.</p>

                <div class="code-block">
                    <div class="code-header">
                        <span class="code-lang">TypeScript - hooks/useRouteSimulation.ts</span>
                        <button class="code-copy-btn" aria-label="Copy code">Copy</button>
                    </div>
                    <pre><code><span class="keyword">import</span> { useState, useEffect, useCallback } <span class="keyword">from</span> <span class="string">'react'</span>;
<span class="keyword">import</span> * <span class="keyword">as</span> turf <span class="keyword">from</span> <span class="string">'@turf/turf'</span>;

<span class="keyword">interface</span> VehiclePosition {
  latitude: <span class="property">number</span>;
  longitude: <span class="property">number</span>;
  bearing: <span class="property">number</span>;
  progress: <span class="property">number</span>; <span class="comment">// 0-1</span>
  currentLegIndex: <span class="property">number</span>;
  eta: Date;
}

<span class="keyword">export function</span> <span class="function">useRouteSimulation</span>(
  routeCoordinates: [<span class="property">number</span>, <span class="property">number</span>][] | <span class="keyword">null</span>,
  speedMultiplier: <span class="property">number</span> = <span class="number">1</span>
) {
  <span class="keyword">const</span> [isSimulating, setIsSimulating] = useState(<span class="keyword">false</span>);
  <span class="keyword">const</span> [vehiclePosition, setVehiclePosition] = useState&lt;VehiclePosition | <span class="keyword">null</span>&gt;(<span class="keyword">null</span>);

  <span class="keyword">const</span> startSimulation = useCallback(() => {
    <span class="keyword">if</span> (!routeCoordinates || routeCoordinates.length < <span class="number">2</span>) <span class="keyword">return</span>;
    setIsSimulating(<span class="keyword">true</span>);
  }, [routeCoordinates]);

  <span class="keyword">const</span> stopSimulation = useCallback(() => {
    setIsSimulating(<span class="keyword">false</span>);
    setVehiclePosition(<span class="keyword">null</span>);
  }, []);

  useEffect(() => {
    <span class="keyword">if</span> (!isSimulating || !routeCoordinates) <span class="keyword">return</span>;

    <span class="keyword">const</span> line = turf.lineString(routeCoordinates);
    <span class="keyword">const</span> totalLength = turf.length(line, { units: <span class="string">'kilometers'</span> });
    <span class="keyword">let</span> currentDistance = <span class="number">0</span>;
    <span class="keyword">const</span> speed = <span class="number">0.5</span> * speedMultiplier; <span class="comment">// km per interval</span>

    <span class="keyword">const</span> interval = setInterval(() => {
      currentDistance += speed;
      <span class="keyword">const</span> progress = Math.min(currentDistance / totalLength, <span class="number">1</span>);

      <span class="keyword">if</span> (progress >= <span class="number">1</span>) {
        stopSimulation();
        <span class="keyword">return</span>;
      }

      <span class="comment">// Get position along route</span>
      <span class="keyword">const</span> point = turf.along(line, currentDistance, { units: <span class="string">'kilometers'</span> });
      <span class="keyword">const</span> coords = point.geometry.coordinates;

      <span class="comment">// Calculate bearing to next point</span>
      <span class="keyword">const</span> nextPoint = turf.along(line, currentDistance + <span class="number">0.1</span>, { units: <span class="string">'kilometers'</span> });
      <span class="keyword">const</span> bearing = turf.bearing(point, nextPoint);

      <span class="comment">// Estimate ETA</span>
      <span class="keyword">const</span> remainingKm = totalLength - currentDistance;
      <span class="keyword">const</span> avgSpeedKmh = <span class="number">40</span>; <span class="comment">// Assume 40 km/h average</span>
      <span class="keyword">const</span> etaMinutes = (remainingKm / avgSpeedKmh) * <span class="number">60</span>;
      <span class="keyword">const</span> eta = <span class="keyword">new</span> Date(Date.now() + etaMinutes * <span class="number">60000</span>);

      setVehiclePosition({
        longitude: coords[<span class="number">0</span>],
        latitude: coords[<span class="number">1</span>],
        bearing,
        progress,
        currentLegIndex: Math.floor(progress * (routeCoordinates.length - <span class="number">1</span>)),
        eta
      });
    }, <span class="number">100</span>);

    <span class="keyword">return</span> () => clearInterval(interval);
  }, [isSimulating, routeCoordinates, speedMultiplier, stopSimulation]);

  <span class="keyword">return</span> {
    isSimulating,
    vehiclePosition,
    startSimulation,
    stopSimulation
  };
}</code></pre>
                </div>

                <h3 id="phase-6">Phase 6: Analytics and Reporting</h3>
                <p>Build a dashboard component that displays route analytics, including distance, estimated time, fuel costs, and CO2 savings compared to unoptimized routes.</p>

                <div class="code-block">
                    <div class="code-header">
                        <span class="code-lang">TypeScript - components/RouteAnalytics.tsx</span>
                        <button class="code-copy-btn" aria-label="Copy code">Copy</button>
                    </div>
                    <pre><code><span class="string">'use client'</span>;

<span class="keyword">interface</span> RouteAnalyticsProps {
  optimizedRoute: {
    distance: <span class="property">number</span>;
    duration: <span class="property">number</span>;
    legs: { distance: <span class="property">number</span>; duration: <span class="property">number</span>; summary: <span class="property">string</span> }[];
  } | <span class="keyword">null</span>;
  baselineDistance?: <span class="property">number</span>;
  aiReasoning?: <span class="property">string</span>;
}

<span class="keyword">export default function</span> <span class="function">RouteAnalytics</span>({
  optimizedRoute,
  baselineDistance,
  aiReasoning
}: RouteAnalyticsProps) {
  <span class="keyword">if</span> (!optimizedRoute) {
    <span class="keyword">return</span> (
      &lt;div className=<span class="string">"bg-gray-900 rounded-xl p-6 border border-gray-800"</span>&gt;
        &lt;p className=<span class="string">"text-gray-400"</span>&gt;
          Add stops and click "Optimize Route" to see analytics.
        &lt;/p&gt;
      &lt;/div&gt;
    );
  }

  <span class="keyword">const</span> distanceKm = optimizedRoute.distance / <span class="number">1000</span>;
  <span class="keyword">const</span> durationHours = optimizedRoute.duration / <span class="number">3600</span>;
  <span class="keyword">const</span> durationMinutes = (optimizedRoute.duration % <span class="number">3600</span>) / <span class="number">60</span>;

  <span class="comment">// Fuel calculations (assume 8L/100km for delivery van)</span>
  <span class="keyword">const</span> fuelConsumption = distanceKm * <span class="number">0.08</span>;
  <span class="keyword">const</span> fuelCost = fuelConsumption * <span class="number">1.50</span>; <span class="comment">// $1.50/L</span>

  <span class="comment">// CO2 calculations (2.31 kg CO2 per liter of diesel)</span>
  <span class="keyword">const</span> co2Emissions = fuelConsumption * <span class="number">2.31</span>;

  <span class="comment">// Savings vs baseline</span>
  <span class="keyword">const</span> distanceSaved = baselineDistance
    ? ((baselineDistance - optimizedRoute.distance) / baselineDistance) * <span class="number">100</span>
    : <span class="number">0</span>;

  <span class="keyword">return</span> (
    &lt;div className=<span class="string">"bg-gray-900 rounded-xl p-6 border border-gray-800 space-y-6"</span>&gt;
      &lt;h3 className=<span class="string">"text-lg font-semibold text-white mb-4"</span>&gt;
        Route Analytics
      &lt;/h3&gt;

      {<span class="comment">/* Key Metrics Grid */</span>}
      &lt;div className=<span class="string">"grid grid-cols-2 gap-4"</span>&gt;
        &lt;div className=<span class="string">"bg-gray-800 rounded-lg p-4"</span>&gt;
          &lt;div className=<span class="string">"text-2xl font-bold text-orange-500"</span>&gt;
            {distanceKm.toFixed(<span class="number">1</span>)} km
          &lt;/div&gt;
          &lt;div className=<span class="string">"text-sm text-gray-400"</span>&gt;Total Distance&lt;/div&gt;
        &lt;/div&gt;

        &lt;div className=<span class="string">"bg-gray-800 rounded-lg p-4"</span>&gt;
          &lt;div className=<span class="string">"text-2xl font-bold text-orange-500"</span>&gt;
            {Math.floor(durationHours)}h {Math.round(durationMinutes)}m
          &lt;/div&gt;
          &lt;div className=<span class="string">"text-sm text-gray-400"</span>&gt;Est. Duration&lt;/div&gt;
        &lt;/div&gt;

        &lt;div className=<span class="string">"bg-gray-800 rounded-lg p-4"</span>&gt;
          &lt;div className=<span class="string">"text-2xl font-bold text-green-500"</span>&gt;
            ${fuelCost.toFixed(<span class="number">2</span>)}
          &lt;/div&gt;
          &lt;div className=<span class="string">"text-sm text-gray-400"</span>&gt;Est. Fuel Cost&lt;/div&gt;
        &lt;/div&gt;

        &lt;div className=<span class="string">"bg-gray-800 rounded-lg p-4"</span>&gt;
          &lt;div className=<span class="string">"text-2xl font-bold text-green-500"</span>&gt;
            {co2Emissions.toFixed(<span class="number">1</span>)} kg
          &lt;/div&gt;
          &lt;div className=<span class="string">"text-sm text-gray-400"</span>&gt;CO2 Emissions&lt;/div&gt;
        &lt;/div&gt;
      &lt;/div&gt;

      {<span class="comment">/* Savings Banner */</span>}
      {distanceSaved > <span class="number">0</span> && (
        &lt;div className=<span class="string">"bg-green-900/30 border border-green-700 rounded-lg p-4"</span>&gt;
          &lt;div className=<span class="string">"flex items-center gap-2"</span>&gt;
            &lt;span className=<span class="string">"text-green-400 text-lg"</span>&gt;Optimized!&lt;/span&gt;
            &lt;span className=<span class="string">"text-green-300"</span>&gt;
              {distanceSaved.toFixed(<span class="number">1</span>)}% shorter than naive route
            &lt;/span&gt;
          &lt;/div&gt;
        &lt;/div&gt;
      )}

      {<span class="comment">/* AI Reasoning */</span>}
      {aiReasoning && (
        &lt;div className=<span class="string">"border-t border-gray-700 pt-4"</span>&gt;
          &lt;h4 className=<span class="string">"text-sm font-medium text-gray-300 mb-2"</span>&gt;
            AI Optimization Reasoning
          &lt;/h4&gt;
          &lt;p className=<span class="string">"text-sm text-gray-400 leading-relaxed"</span>&gt;
            {aiReasoning}
          &lt;/p&gt;
        &lt;/div&gt;
      )}

      {<span class="comment">/* Leg Breakdown */</span>}
      &lt;div className=<span class="string">"border-t border-gray-700 pt-4"</span>&gt;
        &lt;h4 className=<span class="string">"text-sm font-medium text-gray-300 mb-3"</span>&gt;
          Route Breakdown
        &lt;/h4&gt;
        &lt;div className=<span class="string">"space-y-2"</span>&gt;
          {optimizedRoute.legs.map((leg, idx) => (
            &lt;div
              key={idx}
              className=<span class="string">"flex justify-between text-sm py-2 border-b border-gray-800"</span>
            &gt;
              &lt;span className=<span class="string">"text-gray-400"</span>&gt;
                Leg {idx + <span class="number">1</span>}: {leg.summary || <span class="string">'Direct route'</span>}
              &lt;/span&gt;
              &lt;span className=<span class="string">"text-gray-300"</span>&gt;
                {(leg.distance / <span class="number">1000</span>).toFixed(<span class="number">1</span>)} km /
                {Math.round(leg.duration / <span class="number">60</span>)} min
              &lt;/span&gt;
            &lt;/div&gt;
          ))}
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  );
}</code></pre>
                </div>

                <!-- Section: Common Issues -->
                <h2 id="common-issues">Common Issues & Solutions</h2>
                <p>Here are some common issues you might encounter and how to solve them:</p>

                <div class="callout callout-warning">
                    <div class="callout-title">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>
                        Mapbox Token Exposure
                    </div>
                    <p>Never expose your Mapbox secret token in client-side code. Use <code>NEXT_PUBLIC_MAPBOX_TOKEN</code> for the public token (map display) and keep the secret token server-side only for Directions API calls.</p>
                </div>

                <div class="callout callout-warning">
                    <div class="callout-title">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>
                        PostGIS Geography vs Geometry
                    </div>
                    <p>Use <code>GEOGRAPHY</code> type (not <code>GEOMETRY</code>) for real-world coordinates. Geography uses meters for distance calculations and handles Earth's curvature correctly. Geometry uses planar math and is only accurate for small areas.</p>
                </div>

                <p><strong>Other common issues:</strong></p>
                <ul>
                    <li><strong>CORS errors with Mapbox:</strong> Ensure API calls to Mapbox Directions go through your Next.js API routes, not directly from the client</li>
                    <li><strong>Claude JSON parsing:</strong> Always handle cases where Claude wraps JSON in markdown code blocks; use regex to extract the JSON</li>
                    <li><strong>Rate limits:</strong> Implement caching for Mapbox distance matrix results to avoid hitting API limits</li>
                    <li><strong>Large stop counts:</strong> For routes with 25+ stops, batch the optimization or use a hybrid approach with traditional algorithms</li>
                </ul>

                <!-- Section: Next Steps -->
                <h2 id="next-steps">Next Steps</h2>
                <p>Congratulations on building your AI Route Optimizer! Here are some ways to extend the project:</p>

                <ul>
                    <li><strong>Add vehicle constraints:</strong> Implement capacity limits, vehicle types, and driver schedules</li>
                    <li><strong>Real-time traffic:</strong> Integrate Mapbox Traffic API for dynamic route updates</li>
                    <li><strong>Multi-vehicle routing:</strong> Extend to support fleet optimization with multiple drivers</li>
                    <li><strong>Mobile driver app:</strong> Build a React Native companion app for drivers with turn-by-turn navigation</li>
                    <li><strong>Historical analytics:</strong> Track route performance over time and identify optimization opportunities</li>
                </ul>

                <!-- Share Section -->
                <div class="share-section">
                    <span class="share-label">Share this guide:</span>
                    <div class="share-buttons" role="group" aria-label="Share this guide">
                        <button class="share-btn" data-share="twitter" title="Share on Twitter" aria-label="Share on Twitter">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                                <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
                            </svg>
                        </button>
                        <button class="share-btn" data-share="linkedin" title="Share on LinkedIn" aria-label="Share on LinkedIn">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                                <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
                            </svg>
                        </button>
                        <button class="share-btn" data-share="copy" title="Copy link" aria-label="Copy link to clipboard">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                                <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
                                <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
                            </svg>
                        </button>
                        <button class="share-btn" data-share="email" title="Share via email" aria-label="Share via email">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                                <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
                                <polyline points="22,6 12,13 2,6"></polyline>
                            </svg>
                        </button>
                    </div>
                </div>

                <!-- Related Guides -->
                <div class="related-guides">
                    <h3 class="related-guides-title">Related Guides</h3>
                    <div class="related-guides-grid">
                        <a href="/guides/ecommerce-ai-recommender.html" class="related-guide-card">
                            <h4>E-commerce AI Recommender</h4>
                            <p>Build a product recommendation engine with Claude</p>
                        </a>
                        <a href="/guides/realestate-property-matcher.html" class="related-guide-card">
                            <h4>Real Estate Property Matcher</h4>
                            <p>AI-powered property matching with location data</p>
                        </a>
                        <a href="/guides/saas-ai-feature-builder.html" class="related-guide-card">
                            <h4>SaaS AI Feature Builder</h4>
                            <p>Add intelligent features to your SaaS platform</p>
                        </a>
                    </div>
                </div>

                <!-- Follow Section -->
                <div class="follow-section">
                    <h3>Follow the Vibe Coding Enthusiast</h3>
                    <p>Follow JD â€” product updates on LinkedIn, personal takes on X.</p>
                    <div class="social-follow-buttons">
                        <a href="https://www.linkedin.com/in/jeremiahddavid/" target="_blank" rel="noopener noreferrer" class="social-follow-btn linkedin">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg>
                            Follow on LinkedIn
                        </a>
                        <a href="https://x.com/jeremiahddavid" target="_blank" rel="noopener noreferrer" class="social-follow-btn twitter">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
                            Follow on X
                        </a>
                    </div>
                </div>
            </article>
        </div>
    </main>

    <!-- Back to Top Button -->
    <button class="back-to-top" id="backToTop" aria-label="Back to top">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
            <path d="M18 15l-6-6-6 6"/>
        </svg>
    </button>

        <footer class="footer">
    <div class="container">
        <div class="footer-simple">
            <div class="footer-brand">
                <a href="/" class="footer-logo">
                    <img src="/favicon.png" alt="Vibe Coding Enthusiast" class="logo-icon" width="28" height="28">
                    <span>Vibe Coding Enthusiast</span>
                </a>
                <p>Free guides for building with AI</p>
            </div>

            <nav class="footer-nav">
                <a href="/guides/">Guides</a>
                <span class="footer-dot">Â·</span>
                <a href="/paths/">Paths</a>
                <span class="footer-dot">Â·</span>
                <a href="/learn/">Learn</a>
                <span class="footer-dot">Â·</span>
                <a href="/tools/">Tools</a>
                <span class="footer-dot">Â·</span>
                <a href="/stacks/">Stacks</a>
                <span class="footer-dot">Â·</span>
                <a href="/#about">About</a>
            </nav>

            <div class="footer-social">
                <a href="https://www.linkedin.com/in/jeremiahddavid/" target="_blank" rel="noopener noreferrer" aria-label="Follow on LinkedIn">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg>
                </a>
                <a href="https://x.com/jeremiahddavid" target="_blank" rel="noopener noreferrer" aria-label="Follow on X">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
                </a>
            </div>
        </div>

        <div class="footer-bottom">
            <p>Â© 2025 Vibe Coding Enthusiast</p>
            <div class="footer-legal">
                <a href="/privacy.html">Privacy</a>
                <a href="/terms.html">Terms</a>
            </div>
        </div>
    </div>
</footer>

    <script src="/script.js"></script>

    <!-- Guide-Specific JavaScript -->
    <script>
        // Reading Progress Bar
        (function() {
            const progressBar = document.getElementById('readingProgress');
            const article = document.querySelector('.article-content');

            if (progressBar && article) {
                window.addEventListener('scroll', function() {
                    const articleTop = article.offsetTop;
                    const articleHeight = article.offsetHeight;
                    const windowHeight = window.innerHeight;
                    const scrollTop = window.scrollY;

                    const progress = Math.min(100, Math.max(0,
                        ((scrollTop - articleTop + windowHeight * 0.3) / articleHeight) * 100
                    ));

                    progressBar.style.width = progress + '%';
                    progressBar.setAttribute('aria-valuenow', Math.round(progress));
                });
            }
        })();

        // Generate Table of Contents
        (function() {
            const article = document.querySelector('.article-content');
            const tocList = document.getElementById('tocList');

            if (article && tocList) {
                const headings = article.querySelectorAll('h2, h3');
                let tocHTML = '';

                headings.forEach(function(heading) {
                    const id = heading.getAttribute('id');
                    const text = heading.textContent.replace(/#/g, '').trim();
                    const level = heading.tagName.toLowerCase();
                    const className = level === 'h3' ? 'toc-h3' : '';

                    if (id) {
                        tocHTML += '<li><a href="#' + id + '" class="' + className + '">' + text + '</a></li>';

                        // Add anchor link to heading
                        const anchor = document.createElement('a');
                        anchor.href = '#' + id;
                        anchor.className = 'anchor-link';
                        anchor.setAttribute('aria-label', 'Link to ' + text);
                        anchor.textContent = '#';
                        heading.appendChild(anchor);
                    }
                });

                tocList.innerHTML = tocHTML;

                // Highlight active TOC item on scroll
                const tocLinks = tocList.querySelectorAll('a');

                function updateActiveTOC() {
                    const scrollPos = window.scrollY + 120;

                    headings.forEach(function(heading, index) {
                        const id = heading.getAttribute('id');
                        const headingTop = heading.offsetTop;
                        const nextHeading = headings[index + 1];
                        const nextTop = nextHeading ? nextHeading.offsetTop : document.body.scrollHeight;

                        if (scrollPos >= headingTop && scrollPos < nextTop) {
                            tocLinks.forEach(function(link) {
                                link.classList.remove('active');
                                if (link.getAttribute('href') === '#' + id) {
                                    link.classList.add('active');
                                }
                            });
                        }
                    });
                }

                window.addEventListener('scroll', updateActiveTOC);
                updateActiveTOC();
            }
        })();

        // Copy Code Button
        (function() {
            const copyButtons = document.querySelectorAll('.code-copy-btn');

            copyButtons.forEach(function(button) {
                button.addEventListener('click', function() {
                    const codeBlock = this.closest('.code-block');
                    const code = codeBlock.querySelector('code');
                    const text = code.textContent;

                    navigator.clipboard.writeText(text).then(function() {
                        button.textContent = 'Copied!';
                        button.classList.add('copied');

                        setTimeout(function() {
                            button.textContent = 'Copy';
                            button.classList.remove('copied');
                        }, 2000);
                    }).catch(function(err) {
                        console.error('Failed to copy:', err);
                    });
                });
            });
        })();

        // Share Buttons
        (function() {
            const shareButtons = document.querySelectorAll('.share-btn');
            const pageTitle = document.title;
            const pageUrl = window.location.href;

            shareButtons.forEach(function(button) {
                button.addEventListener('click', function() {
                    const shareType = this.getAttribute('data-share');
                    let shareUrl = '';

                    switch(shareType) {
                        case 'twitter':
                            shareUrl = 'https://twitter.com/intent/tweet?text=' + encodeURIComponent(pageTitle) + '&url=' + encodeURIComponent(pageUrl);
                            window.open(shareUrl, '_blank', 'width=550,height=420');
                            break;
                        case 'linkedin':
                            shareUrl = 'https://www.linkedin.com/sharing/share-offsite/?url=' + encodeURIComponent(pageUrl);
                            window.open(shareUrl, '_blank', 'width=550,height=420');
                            break;
                        case 'copy':
                            navigator.clipboard.writeText(pageUrl).then(function() {
                                const originalTitle = button.getAttribute('title');
                                button.setAttribute('title', 'Link copied!');
                                setTimeout(function() {
                                    button.setAttribute('title', originalTitle);
                                }, 2000);
                            });
                            break;
                        case 'email':
                            shareUrl = 'mailto:?subject=' + encodeURIComponent(pageTitle) + '&body=' + encodeURIComponent('Check out this guide: ' + pageUrl);
                            window.location.href = shareUrl;
                            break;
                    }
                });
            });
        })();
    </script>
</body>
</html>
