<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <!-- Primary Meta Tags -->
    <title>Build AI Features for Your SaaS | AI Build Guides | Vibe Coding Enthusiast</title>
    <meta name="title" content="Build AI Features for Your SaaS | AI Build Guides | Vibe Coding Enthusiast">
    <meta name="description" content="Complete guide to integrating AI capabilities into existing SaaS products. Learn rate limiting, streaming chat, document analysis, and AI-powered content generation.">
    <meta name="keywords" content="saas ai integration, ai features, claude api, openai, streaming chat, document analysis, ai development, vibe coding, build guide, tutorial">
    <meta name="author" content="Vibe Coding Enthusiast">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://vibecodingenthusiast.com/guides/saas-ai-feature-builder.html">

    <!-- Favicon -->
    <link rel="icon" type="image/png" href="/favicon.png">
    <link rel="apple-touch-icon" href="/favicon.png">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://vibecodingenthusiast.com/guides/saas-ai-feature-builder.html">
    <meta property="og:title" content="Build AI Features for Your SaaS | AI Build Guides">
    <meta property="og:description" content="Complete guide to integrating AI capabilities into existing SaaS products. Learn rate limiting, streaming chat, document analysis, and AI-powered content generation.">
    <meta property="og:image" content="https://vibecodingenthusiast.com/guides/images/saas-ai-feature-builder-og.png">
    <meta property="og:site_name" content="Vibe Coding Enthusiast">
    <meta property="og:locale" content="en_US">
    <meta property="article:published_time" content="2025-01-14">
    <meta property="article:modified_time" content="2025-01-14">
    <meta property="article:author" content="Vibe Coding Enthusiast">
    <meta property="article:section" content="AI Build Guides">
    <meta property="article:tag" content="SaaS">

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https://vibecodingenthusiast.com/guides/saas-ai-feature-builder.html">
    <meta name="twitter:title" content="Build AI Features for Your SaaS | AI Build Guides">
    <meta name="twitter:description" content="Complete guide to integrating AI capabilities into existing SaaS products. Learn rate limiting, streaming chat, document analysis, and AI-powered content generation.">
    <meta name="twitter:image" content="https://vibecodingenthusiast.com/guides/images/saas-ai-feature-builder-og.png">
    <meta name="twitter:creator" content="@vibecodingenthusiast">

    <!-- Schema.org JSON-LD for TechArticle -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "TechArticle",
        "headline": "Build AI Features for Your SaaS",
        "description": "Complete guide to integrating AI capabilities into existing SaaS products. Learn rate limiting, streaming chat, document analysis, and AI-powered content generation.",
        "image": "https://vibecodingenthusiast.com/guides/images/saas-ai-feature-builder-og.png",
        "author": {
            "@type": "Organization",
            "name": "Vibe Coding Enthusiast",
            "url": "https://vibecodingenthusiast.com"
        },
        "publisher": {
            "@type": "Organization",
            "name": "Vibe Coding Enthusiast",
            "logo": {
                "@type": "ImageObject",
                "url": "https://vibecodingenthusiast.com/favicon.png"
            }
        },
        "datePublished": "2025-01-14",
        "dateModified": "2025-01-14",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https://vibecodingenthusiast.com/guides/saas-ai-feature-builder.html"
        },
        "articleSection": "AI Build Guides",
        "keywords": "saas ai integration, ai features, claude api, openai, streaming chat, document analysis",
        "proficiencyLevel": "Intermediate",
        "dependencies": "Claude API, OpenAI, Redis, Upstash, Inngest, QStash, PostgreSQL",
        "timeRequired": "PT300M"
    }
    </script>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="/styles.css">

</head>
<body>
    <a href="#main" class="skip-link">Skip to main content</a>

    <!-- Reading Progress Bar -->
    <div class="reading-progress" id="readingProgress" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" aria-label="Reading progress"></div>

    <!-- Header -->
    <header class="header">
        <nav class="nav container" role="navigation" aria-label="Main navigation">
            <a href="/" class="logo" aria-label="Vibe Coding Enthusiast - Home">
                <img src="/favicon.png" alt="Vibe Coding Enthusiast" class="logo-icon" width="28" height="28">
                <span class="logo-text">VibeCoding<span class="accent">Enthusiast</span></span>
            </a>
            <ul class="nav-links">
                <li><a href="/">Home</a></li>
                <li><a href="/guides/">Guides</a></li>
                <li><a href="/paths/">Paths</a></li>
                <li><a href="/learn/">Learn</a></li>
                <li><a href="/tools/">Tools</a></li>
                <li><a href="/stacks/">Stacks</a></li>
                <li><a href="/industries/">Industries</a></li>
                <li><a href="/#about">About</a></li>
            </ul>
            <div class="nav-actions">
                <a href="/guides/" class="btn btn-primary">Explore Guides</a>
            </div>
            <button class="mobile-menu-btn" aria-label="Toggle menu" aria-expanded="false">
                <span></span><span></span><span></span>
            </button>
        </nav>
    </header>

    <main id="main">
        <!-- Article Header -->
        <section class="article-header">
            <div class="container">
                <!-- Breadcrumb Navigation -->
                <nav class="breadcrumb" aria-label="Breadcrumb">
                    <a href="/">Home</a>
                    <span class="breadcrumb-separator" aria-hidden="true">/</span>
                    <a href="/guides/">Guides</a>
                    <span class="breadcrumb-separator" aria-hidden="true">/</span>
                    <span class="breadcrumb-current" aria-current="page">SaaS AI Feature Builder</span>
                </nav>

                <!-- Guide Meta Badges -->
                <div class="guide-meta">
                    <span class="badge badge-intermediate">Intermediate</span>
                    <span class="badge badge-time">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                            <circle cx="12" cy="12" r="10"></circle>
                            <polyline points="12 6 12 12 16 14"></polyline>
                        </svg>
                        ~5 hours
                    </span>
                </div>

                <!-- Title -->
                <h1 class="gradient-text">Build AI Features for Your SaaS</h1>

                <!-- Description -->
                <p class="lead">A comprehensive meta-guide for adding AI capabilities to existing SaaS products. Learn integration patterns for streaming chat, document analysis, content generation, and usage-based billing.</p>

                <!-- Share Buttons -->
                <div class="share-buttons" role="group" aria-label="Share this guide">
                    <button class="share-btn" data-share="twitter" title="Share on Twitter" aria-label="Share on Twitter">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                            <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
                        </svg>
                    </button>
                    <button class="share-btn" data-share="linkedin" title="Share on LinkedIn" aria-label="Share on LinkedIn">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                            <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
                        </svg>
                    </button>
                    <button class="share-btn" data-share="copy" title="Copy link" aria-label="Copy link to clipboard">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                            <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
                            <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
                        </svg>
                    </button>
                </div>
            </div>
        </section>

        <!-- Main Content with TOC Sidebar -->
        <div class="article-layout">
            <!-- Table of Contents Sidebar -->
            <aside class="toc-sidebar" aria-label="Table of contents">
                <div class="toc-title">On this page</div>
                <ul class="toc-list" id="tocList">
                    <noscript>
                        <li><a href="#overview">What We're Building</a></li>
                        <li><a href="#prerequisites">Prerequisites</a></li>
                        <li><a href="#tech-stack">Tech Stack</a></li>
                        <li><a href="#ai-workflow">AI Agent Workflow</a></li>
                        <li><a href="#build-steps">Build Steps</a></li>
                        <li><a href="#common-issues">Common Issues</a></li>
                        <li><a href="#next-steps">Next Steps</a></li>
                    </noscript>
                </ul>
            </aside>

            <!-- Article Content -->
            <article class="article-content">
                <!-- Section: What We're Building -->
                <h2 id="overview">What We're Building</h2>
                <p>This guide walks you through adding AI capabilities to an existing SaaS product. Unlike building AI-first applications from scratch, integrating AI into established products requires careful consideration of existing architecture, user workflows, and business models.</p>

                <p>We'll cover the most common AI integration patterns that SaaS companies are adopting:</p>

                <div class="feature-grid">
                    <div class="feature-card">
                        <div class="icon">ğŸ’¬</div>
                        <h4>Streaming Chat</h4>
                        <p>Real-time AI assistant with context awareness</p>
                    </div>
                    <div class="feature-card">
                        <div class="icon">ğŸ“„</div>
                        <h4>Document Analysis</h4>
                        <p>Extract insights from uploaded files</p>
                    </div>
                    <div class="feature-card">
                        <div class="icon">âœï¸</div>
                        <h4>Content Generation</h4>
                        <p>AI-powered reports and summaries</p>
                    </div>
                    <div class="feature-card">
                        <div class="icon">ğŸ“Š</div>
                        <h4>Usage Billing</h4>
                        <p>Token-based metering and limits</p>
                    </div>
                </div>

                <p>By the end of this guide, you'll have production-ready patterns for integrating multiple AI providers, handling rate limits, streaming responses, and tracking AI usage for billing purposes.</p>

                <!-- Section: Prerequisites -->
                <h2 id="prerequisites">Prerequisites</h2>
                <p>Before starting this guide, make sure you have the following:</p>
                <ul>
                    <li><strong>Existing SaaS application</strong> - A working product with authentication, database, and API infrastructure</li>
                    <li><strong>API keys</strong> - Claude API key (Anthropic) and/or OpenAI API key</li>
                    <li><strong>Node.js 18+</strong> and experience with TypeScript</li>
                    <li><strong>PostgreSQL database</strong> for storing usage data and conversation history</li>
                    <li><strong>Redis instance</strong> for rate limiting and job queues (can use Upstash for serverless)</li>
                    <li><strong>Basic understanding</strong> of streaming responses and Server-Sent Events (SSE)</li>
                </ul>

                <div class="callout callout-info">
                    <div class="callout-title">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>
                        Multi-Provider Strategy
                    </div>
                    <p>We recommend using both Claude and OpenAI APIs. This provides redundancy if one service has issues, and allows you to use the best model for each task (e.g., Claude for nuanced conversations, GPT-4 for structured outputs).</p>
                </div>

                <!-- Section: Tech Stack -->
                <h2 id="tech-stack">Tech Stack Specification</h2>
                <p>Here's the recommended technology stack for AI integration into existing SaaS products:</p>
                <table class="tech-stack-table">
                    <thead>
                        <tr>
                            <th scope="col">Layer</th>
                            <th scope="col">Technology</th>
                            <th scope="col">Why This Choice</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>AI Integration</td>
                            <td>Claude API, OpenAI</td>
                            <td>Core AI capabilities with provider redundancy and model flexibility</td>
                        </tr>
                        <tr>
                            <td>Caching</td>
                            <td>Redis / Upstash</td>
                            <td>Response caching to reduce API costs and improve latency</td>
                        </tr>
                        <tr>
                            <td>Queue</td>
                            <td>Inngest / QStash</td>
                            <td>Background processing for long-running AI tasks without timeouts</td>
                        </tr>
                        <tr>
                            <td>Rate Limiting</td>
                            <td>Upstash</td>
                            <td>Usage management with sliding window algorithms per tier</td>
                        </tr>
                        <tr>
                            <td>Database</td>
                            <td>PostgreSQL</td>
                            <td>Usage tracking, conversation history, and cost analytics</td>
                        </tr>
                    </tbody>
                </table>

                <!-- Architecture Diagram -->
                <h3 id="architecture">AI Integration Architecture</h3>
                <p>Here's how the AI components integrate with a typical SaaS architecture:</p>

                <div class="architecture-diagram">
                    <pre>
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         CLIENT (React/Next.js)                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚  Chat Widget â”‚  â”‚ Doc Upload   â”‚  â”‚ AI Reports   â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚         â”‚                 â”‚                 â”‚                       â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚                           â”‚ SSE / REST                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     API LAYER (Node.js)                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                    Rate Limiter (Redis)                       â”‚  â”‚
â”‚  â”‚         Per-user limits â”‚ Per-org limits â”‚ Global limits      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                           â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚ AI Router    â”‚  â”‚ Usage Trackerâ”‚  â”‚ Job Queue    â”‚              â”‚
â”‚  â”‚ Claude/GPT   â”‚  â”‚ Tokens/Costs â”‚  â”‚ BullMQ       â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                 â”‚                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         â–¼                 â–¼                 â–¼                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚ Claude API   â”‚  â”‚ PostgreSQL   â”‚  â”‚ Redis        â”‚              â”‚
â”‚  â”‚ OpenAI API   â”‚  â”‚ Usage logs   â”‚  â”‚ Queue + Rate â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                         DATA LAYER                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    </pre>
                </div>

                <!-- Section: AI Agent Workflow -->
                <h2 id="ai-workflow">AI Agent Workflow</h2>
                <p>Here's how to leverage AI tools throughout this build to maximize productivity:</p>

                <h3 id="ai-scaffolding">Project Setup with Claude Code</h3>
                <p>Use Claude Code to scaffold the AI integration layer based on your existing codebase structure:</p>

                <div class="code-block">
                    <div class="code-header">
                        <span class="code-lang">Prompt</span>
                        <button class="code-copy-btn" aria-label="Copy code">Copy</button>
                    </div>
                    <pre><code><span class="comment"># Example prompt for Claude Code</span>
"Analyze my existing SaaS codebase and create an AI integration
layer that includes:
1. A unified AI client that supports both Claude and OpenAI
2. Rate limiting middleware using Redis
3. Usage tracking with PostgreSQL
4. Streaming response handlers for SSE

Follow my existing patterns for error handling and authentication.
Use TypeScript and match my current code style."</code></pre>
                </div>

                <h3 id="ai-ui">UI Generation with v0.dev</h3>
                <p>Generate chat interfaces and AI-powered UI components quickly:</p>

                <div class="callout callout-tip">
                    <div class="callout-title">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M12 2v4M12 18v4M4.93 4.93l2.83 2.83M16.24 16.24l2.83 2.83M2 12h4M18 12h4M4.93 19.07l2.83-2.83M16.24 7.76l2.83-2.83"/></svg>
                        Pro Tip
                    </div>
                    <p>When prompting v0.dev, describe your existing design system colors and patterns. Ask for "a chat widget that matches a dark SaaS dashboard with purple accent colors" to get components that integrate seamlessly.</p>
                </div>

                <h3 id="ai-debugging">Development with Cursor</h3>
                <p>Cursor excels at understanding API documentation. Paste Claude or OpenAI API docs directly and ask Cursor to generate type-safe client wrappers and error handling.</p>

                <!-- Section: Build Steps -->
                <h2 id="build-steps">Step-by-Step Build Guide</h2>

                <h3 id="phase-1">Phase 1: AI Architecture Patterns for SaaS</h3>
                <p>Before writing code, establish your AI architecture patterns and database schema. These patterns work for any SaaS product adding AI features - whether you're building chat, analysis, or generation capabilities:</p>

                <div class="code-block">
                    <div class="code-header">
                        <span class="code-lang">SQL</span>
                        <button class="code-copy-btn" aria-label="Copy code">Copy</button>
                    </div>
                    <pre><code><span class="comment">-- AI usage tracking schema</span>
<span class="keyword">CREATE TABLE</span> ai_conversations (
  id <span class="variable">UUID</span> <span class="keyword">PRIMARY KEY DEFAULT</span> gen_random_uuid(),
  user_id <span class="variable">UUID</span> <span class="keyword">REFERENCES</span> users(id),
  org_id <span class="variable">UUID</span> <span class="keyword">REFERENCES</span> organizations(id),
  title <span class="variable">VARCHAR</span>(<span class="number">255</span>),
  context <span class="variable">JSONB</span>, <span class="comment">-- Store app-specific context</span>
  created_at <span class="variable">TIMESTAMPTZ</span> <span class="keyword">DEFAULT</span> now(),
  updated_at <span class="variable">TIMESTAMPTZ</span> <span class="keyword">DEFAULT</span> now()
);

<span class="keyword">CREATE TABLE</span> ai_messages (
  id <span class="variable">UUID</span> <span class="keyword">PRIMARY KEY DEFAULT</span> gen_random_uuid(),
  conversation_id <span class="variable">UUID</span> <span class="keyword">REFERENCES</span> ai_conversations(id),
  role <span class="variable">VARCHAR</span>(<span class="number">20</span>) <span class="keyword">NOT NULL</span>, <span class="comment">-- 'user', 'assistant', 'system'</span>
  content <span class="variable">TEXT</span> <span class="keyword">NOT NULL</span>,
  model <span class="variable">VARCHAR</span>(<span class="number">50</span>), <span class="comment">-- 'claude-3-opus', 'gpt-4', etc.</span>
  tokens_input <span class="variable">INTEGER</span>,
  tokens_output <span class="variable">INTEGER</span>,
  cost_cents <span class="variable">DECIMAL</span>(<span class="number">10</span>,<span class="number">4</span>),
  created_at <span class="variable">TIMESTAMPTZ</span> <span class="keyword">DEFAULT</span> now()
);

<span class="keyword">CREATE TABLE</span> ai_usage_daily (
  id <span class="variable">UUID</span> <span class="keyword">PRIMARY KEY DEFAULT</span> gen_random_uuid(),
  org_id <span class="variable">UUID</span> <span class="keyword">REFERENCES</span> organizations(id),
  date <span class="variable">DATE</span> <span class="keyword">NOT NULL</span>,
  total_tokens <span class="variable">BIGINT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>,
  total_requests <span class="variable">INTEGER</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>,
  total_cost_cents <span class="variable">DECIMAL</span>(<span class="number">10</span>,<span class="number">2</span>) <span class="keyword">DEFAULT</span> <span class="number">0</span>,
  <span class="keyword">UNIQUE</span>(org_id, date)
);

<span class="keyword">CREATE INDEX</span> idx_ai_messages_conversation <span class="keyword">ON</span> ai_messages(conversation_id);
<span class="keyword">CREATE INDEX</span> idx_ai_usage_org_date <span class="keyword">ON</span> ai_usage_daily(org_id, date);</code></pre>
                </div>

                <h3 id="phase-2">Phase 2: Claude API Integration Setup</h3>
                <p>Set up a unified AI client that supports both Claude and OpenAI with automatic failover. This abstraction makes it easy to switch models or add new providers later:</p>

                <div class="code-block">
                    <div class="code-header">
                        <span class="code-lang">TypeScript</span>
                        <button class="code-copy-btn" aria-label="Copy code">Copy</button>
                    </div>
                    <pre><code><span class="comment">// lib/ai/providers.ts</span>
<span class="keyword">import</span> Anthropic <span class="keyword">from</span> <span class="string">'@anthropic-ai/sdk'</span>;
<span class="keyword">import</span> OpenAI <span class="keyword">from</span> <span class="string">'openai'</span>;

<span class="comment">// Initialize API clients</span>
<span class="keyword">export const</span> anthropic = <span class="keyword">new</span> Anthropic({
  apiKey: process.env.ANTHROPIC_API_KEY!,
});

<span class="keyword">export const</span> openai = <span class="keyword">new</span> OpenAI({
  apiKey: process.env.OPENAI_API_KEY!,
});

<span class="comment">// Model configurations for different use cases</span>
<span class="keyword">export const</span> AI_MODELS = {
  <span class="comment">// Claude models - great for nuanced conversation</span>
  claude: {
    fast: <span class="string">'claude-3-haiku-20240307'</span>,
    balanced: <span class="string">'claude-3-sonnet-20240229'</span>,
    powerful: <span class="string">'claude-3-opus-20240229'</span>,
  },
  <span class="comment">// OpenAI models - great for structured output</span>
  openai: {
    fast: <span class="string">'gpt-4o-mini'</span>,
    balanced: <span class="string">'gpt-4o'</span>,
    powerful: <span class="string">'gpt-4-turbo'</span>,
  },
} <span class="keyword">as const</span>;

<span class="comment">// Helper to select model based on task complexity</span>
<span class="keyword">export function</span> <span class="function">selectModel</span>(
  provider: <span class="string">'claude'</span> | <span class="string">'openai'</span>,
  complexity: <span class="string">'fast'</span> | <span class="string">'balanced'</span> | <span class="string">'powerful'</span>
): <span class="variable">string</span> {
  <span class="keyword">return</span> AI_MODELS[provider][complexity];
}</code></pre>
                </div>

                <h3 id="phase-3">Phase 3: Streaming Responses Implementation</h3>
                <p>Streaming is essential for responsive AI chat. Users see tokens as they arrive instead of waiting for the complete response. This unified client supports both Claude and OpenAI with automatic fallback:</p>

                <div class="code-block">
                    <div class="code-header">
                        <span class="code-lang">TypeScript</span>
                        <button class="code-copy-btn" aria-label="Copy code">Copy</button>
                    </div>
                    <pre><code><span class="comment">// lib/ai/unified-client.ts</span>
<span class="keyword">import</span> Anthropic <span class="keyword">from</span> <span class="string">'@anthropic-ai/sdk'</span>;
<span class="keyword">import</span> OpenAI <span class="keyword">from</span> <span class="string">'openai'</span>;

<span class="keyword">const</span> anthropic = <span class="keyword">new</span> Anthropic({ apiKey: process.env.ANTHROPIC_API_KEY });
<span class="keyword">const</span> openai = <span class="keyword">new</span> OpenAI({ apiKey: process.env.OPENAI_API_KEY });

<span class="keyword">export interface</span> ChatMessage {
  role: <span class="string">'user'</span> | <span class="string">'assistant'</span> | <span class="string">'system'</span>;
  content: <span class="variable">string</span>;
}

<span class="keyword">export interface</span> StreamCallbacks {
  onToken: (token: <span class="variable">string</span>) =&gt; <span class="variable">void</span>;
  onComplete: (usage: { input: <span class="variable">number</span>; output: <span class="variable">number</span> }) =&gt; <span class="variable">void</span>;
  onError: (error: Error) =&gt; <span class="variable">void</span>;
}

<span class="keyword">export async function</span> <span class="function">streamChat</span>(
  messages: ChatMessage[],
  options: {
    model?: <span class="variable">string</span>;
    systemPrompt?: <span class="variable">string</span>;
    maxTokens?: <span class="variable">number</span>;
  },
  callbacks: StreamCallbacks
): <span class="keyword">Promise</span>&lt;<span class="variable">void</span>&gt; {
  <span class="keyword">const</span> model = options.model || <span class="string">'claude-3-sonnet-20240229'</span>;
  <span class="keyword">const</span> isClaude = model.startsWith(<span class="string">'claude'</span>);

  <span class="keyword">try</span> {
    <span class="keyword">if</span> (isClaude) {
      <span class="keyword">await</span> <span class="function">streamClaude</span>(messages, options, callbacks);
    } <span class="keyword">else</span> {
      <span class="keyword">await</span> <span class="function">streamOpenAI</span>(messages, options, callbacks);
    }
  } <span class="keyword">catch</span> (error) {
    <span class="comment">// Fallback to alternate provider on failure</span>
    console.error(<span class="string">`Primary AI failed, attempting fallback`</span>, error);
    <span class="keyword">try</span> {
      <span class="keyword">if</span> (isClaude) {
        <span class="keyword">await</span> <span class="function">streamOpenAI</span>(messages, { ...options, model: <span class="string">'gpt-4o'</span> }, callbacks);
      } <span class="keyword">else</span> {
        <span class="keyword">await</span> <span class="function">streamClaude</span>(messages, { ...options, model: <span class="string">'claude-3-sonnet-20240229'</span> }, callbacks);
      }
    } <span class="keyword">catch</span> (fallbackError) {
      callbacks.onError(fallbackError <span class="keyword">as</span> Error);
    }
  }
}

<span class="keyword">async function</span> <span class="function">streamClaude</span>(
  messages: ChatMessage[],
  options: { systemPrompt?: <span class="variable">string</span>; maxTokens?: <span class="variable">number</span>; model?: <span class="variable">string</span> },
  callbacks: StreamCallbacks
): <span class="keyword">Promise</span>&lt;<span class="variable">void</span>&gt; {
  <span class="keyword">const</span> stream = <span class="keyword">await</span> anthropic.messages.stream({
    model: options.model || <span class="string">'claude-3-sonnet-20240229'</span>,
    max_tokens: options.maxTokens || <span class="number">1024</span>,
    system: options.systemPrompt,
    messages: messages.filter(m =&gt; m.role !== <span class="string">'system'</span>).map(m =&gt; ({
      role: m.role <span class="keyword">as</span> <span class="string">'user'</span> | <span class="string">'assistant'</span>,
      content: m.content,
    })),
  });

  <span class="keyword">for await</span> (<span class="keyword">const</span> event <span class="keyword">of</span> stream) {
    <span class="keyword">if</span> (event.type === <span class="string">'content_block_delta'</span> && event.delta.type === <span class="string">'text_delta'</span>) {
      callbacks.onToken(event.delta.text);
    }
  }

  <span class="keyword">const</span> finalMessage = <span class="keyword">await</span> stream.finalMessage();
  callbacks.onComplete({
    input: finalMessage.usage.input_tokens,
    output: finalMessage.usage.output_tokens,
  });
}</code></pre>
                </div>

                <h3 id="phase-4">Phase 4: Usage Tracking and Rate Limiting</h3>
                <p>Implement rate limiting before exposing AI endpoints. This protects your costs and ensures fair usage across customers. Use Upstash for serverless-friendly rate limiting:</p>

                <div class="code-block">
                    <div class="code-header">
                        <span class="code-lang">TypeScript</span>
                        <button class="code-copy-btn" aria-label="Copy code">Copy</button>
                    </div>
                    <pre><code><span class="comment">// lib/ai/rate-limiter.ts</span>
<span class="keyword">import</span> { Redis } <span class="keyword">from</span> <span class="string">'@upstash/redis'</span>;
<span class="keyword">import</span> { Ratelimit } <span class="keyword">from</span> <span class="string">'@upstash/ratelimit'</span>;

<span class="keyword">const</span> redis = <span class="keyword">new</span> Redis({
  url: process.env.UPSTASH_REDIS_URL!,
  token: process.env.UPSTASH_REDIS_TOKEN!,
});

<span class="comment">// Different limits for different subscription tiers</span>
<span class="keyword">export const</span> rateLimiters = {
  <span class="comment">// Free tier: 10 requests per minute</span>
  free: <span class="keyword">new</span> Ratelimit({
    redis,
    limiter: Ratelimit.slidingWindow(<span class="number">10</span>, <span class="string">'1 m'</span>),
    prefix: <span class="string">'ai:free'</span>,
  }),

  <span class="comment">// Pro tier: 60 requests per minute</span>
  pro: <span class="keyword">new</span> Ratelimit({
    redis,
    limiter: Ratelimit.slidingWindow(<span class="number">60</span>, <span class="string">'1 m'</span>),
    prefix: <span class="string">'ai:pro'</span>,
  }),

  <span class="comment">// Enterprise: 200 requests per minute</span>
  enterprise: <span class="keyword">new</span> Ratelimit({
    redis,
    limiter: Ratelimit.slidingWindow(<span class="number">200</span>, <span class="string">'1 m'</span>),
    prefix: <span class="string">'ai:enterprise'</span>,
  }),
};

<span class="keyword">export async function</span> <span class="function">checkRateLimit</span>(
  orgId: <span class="variable">string</span>,
  tier: <span class="string">'free'</span> | <span class="string">'pro'</span> | <span class="string">'enterprise'</span>
): <span class="keyword">Promise</span>&lt;{ success: <span class="variable">boolean</span>; remaining: <span class="variable">number</span> }&gt; {
  <span class="keyword">const</span> limiter = rateLimiters[tier];
  <span class="keyword">const</span> { success, remaining } = <span class="keyword">await</span> limiter.limit(orgId);

  <span class="keyword">return</span> { success, remaining };
}</code></pre>
                </div>

                <p>Track usage for billing and analytics with a dedicated usage tracker:</p>

                <div class="code-block">
                    <div class="code-header">
                        <span class="code-lang">TypeScript</span>
                        <button class="code-copy-btn" aria-label="Copy code">Copy</button>
                    </div>
                    <pre><code><span class="comment">// lib/ai/usage-tracker.ts</span>
<span class="keyword">import</span> { db } <span class="keyword">from</span> <span class="string">'@/lib/db'</span>;

<span class="keyword">interface</span> UsageRecord {
  orgId: <span class="variable">string</span>;
  userId: <span class="variable">string</span>;
  model: <span class="variable">string</span>;
  tokensInput: <span class="variable">number</span>;
  tokensOutput: <span class="variable">number</span>;
}

<span class="comment">// Model pricing per 1K tokens (in cents)</span>
<span class="keyword">const</span> PRICING = {
  <span class="string">'claude-3-opus'</span>: { input: <span class="number">1.5</span>, output: <span class="number">7.5</span> },
  <span class="string">'claude-3-sonnet'</span>: { input: <span class="number">0.3</span>, output: <span class="number">1.5</span> },
  <span class="string">'claude-3-haiku'</span>: { input: <span class="number">0.025</span>, output: <span class="number">0.125</span> },
  <span class="string">'gpt-4-turbo'</span>: { input: <span class="number">1.0</span>, output: <span class="number">3.0</span> },
  <span class="string">'gpt-4o'</span>: { input: <span class="number">0.5</span>, output: <span class="number">1.5</span> },
};

<span class="keyword">export async function</span> <span class="function">trackUsage</span>(usage: UsageRecord): <span class="keyword">Promise</span>&lt;<span class="variable">void</span>&gt; {
  <span class="keyword">const</span> pricing = PRICING[usage.model <span class="keyword">as</span> keyof <span class="keyword">typeof</span> PRICING];
  <span class="keyword">const</span> costCents =
    (usage.tokensInput / <span class="number">1000</span>) * pricing.input +
    (usage.tokensOutput / <span class="number">1000</span>) * pricing.output;

  <span class="comment">// Update daily aggregates (upsert pattern)</span>
  <span class="keyword">await</span> db.query(<span class="string">`
    INSERT INTO ai_usage_daily (org_id, date, total_tokens, total_requests, total_cost_cents)
    VALUES ($1, CURRENT_DATE, $2, 1, $3)
    ON CONFLICT (org_id, date)
    DO UPDATE SET
      total_tokens = ai_usage_daily.total_tokens + $2,
      total_requests = ai_usage_daily.total_requests + 1,
      total_cost_cents = ai_usage_daily.total_cost_cents + $3
  `</span>, [
    usage.orgId,
    usage.tokensInput + usage.tokensOutput,
    costCents
  ]);
}

<span class="keyword">export async function</span> <span class="function">checkMonthlyLimit</span>(
  orgId: <span class="variable">string</span>,
  limitCents: <span class="variable">number</span>
): <span class="keyword">Promise</span>&lt;{ withinLimit: <span class="variable">boolean</span>; used: <span class="variable">number</span> }&gt; {
  <span class="keyword">const</span> result = <span class="keyword">await</span> db.query(<span class="string">`
    SELECT COALESCE(SUM(total_cost_cents), 0) as total
    FROM ai_usage_daily
    WHERE org_id = $1
    AND date >= DATE_TRUNC('month', CURRENT_DATE)
  `</span>, [orgId]);

  <span class="keyword">const</span> used = parseFloat(result.rows[<span class="number">0</span>].total);
  <span class="keyword">return</span> { withinLimit: used < limitCents, used };
}</code></pre>
                </div>

                <h3 id="phase-5">Phase 5: Background AI Processing</h3>
                <p>Long-running AI tasks like document analysis or report generation should run in the background using Inngest or QStash. This avoids timeout issues and provides better UX:</p>

                <div class="code-block">
                    <div class="code-header">
                        <span class="code-lang">TypeScript</span>
                        <button class="code-copy-btn" aria-label="Copy code">Copy</button>
                    </div>
                    <pre><code><span class="comment">// lib/ai/content-generator.ts</span>
<span class="keyword">import</span> { Queue, Worker } <span class="keyword">from</span> <span class="string">'bullmq'</span>;
<span class="keyword">import</span> { anthropic } <span class="keyword">from</span> <span class="string">'./unified-client'</span>;

<span class="keyword">const</span> connection = {
  host: process.env.REDIS_HOST,
  port: parseInt(process.env.REDIS_PORT || <span class="string">'6379'</span>)
};

<span class="comment">// Queue for long-running AI generation tasks</span>
<span class="keyword">export const</span> contentQueue = <span class="keyword">new</span> Queue(<span class="string">'ai-content'</span>, { connection });

<span class="keyword">interface</span> ContentJob {
  type: <span class="string">'report'</span> | <span class="string">'email'</span> | <span class="string">'summary'</span>;
  data: Record&lt;<span class="variable">string</span>, <span class="variable">any</span>&gt;;
  orgId: <span class="variable">string</span>;
  userId: <span class="variable">string</span>;
  webhookUrl?: <span class="variable">string</span>;
}

<span class="comment">// Add a content generation job</span>
<span class="keyword">export async function</span> <span class="function">queueContentGeneration</span>(
  job: ContentJob
): <span class="keyword">Promise</span>&lt;<span class="variable">string</span>&gt; {
  <span class="keyword">const</span> result = <span class="keyword">await</span> contentQueue.add(<span class="string">'generate'</span>, job, {
    attempts: <span class="number">3</span>,
    backoff: { type: <span class="string">'exponential'</span>, delay: <span class="number">1000</span> },
  });
  <span class="keyword">return</span> result.id!;
}

<span class="comment">// Worker to process content generation</span>
<span class="keyword">const</span> worker = <span class="keyword">new</span> Worker(<span class="string">'ai-content'</span>, <span class="keyword">async</span> (job) =&gt; {
  <span class="keyword">const</span> { type, data, orgId, userId, webhookUrl } = job.data <span class="keyword">as</span> ContentJob;

  <span class="keyword">const</span> templates = {
    report: <span class="string">`Generate a detailed report based on: ${JSON.stringify(data)}`</span>,
    email: <span class="string">`Write a professional email: ${JSON.stringify(data)}`</span>,
    summary: <span class="string">`Create an executive summary: ${JSON.stringify(data)}`</span>,
  };

  <span class="keyword">const</span> response = <span class="keyword">await</span> anthropic.messages.create({
    model: <span class="string">'claude-3-opus-20240229'</span>, <span class="comment">// Use Opus for quality content</span>
    max_tokens: <span class="number">4096</span>,
    messages: [{ role: <span class="string">'user'</span>, content: templates[type] }],
  });

  <span class="keyword">const</span> content = response.content[<span class="number">0</span>].type === <span class="string">'text'</span>
    ? response.content[<span class="number">0</span>].text
    : <span class="string">''</span>;

  <span class="comment">// Notify via webhook if provided</span>
  <span class="keyword">if</span> (webhookUrl) {
    <span class="keyword">await</span> fetch(webhookUrl, {
      method: <span class="string">'POST'</span>,
      headers: { <span class="string">'Content-Type'</span>: <span class="string">'application/json'</span> },
      body: JSON.stringify({ jobId: job.id, content, type }),
    });
  }

  <span class="keyword">return</span> { content, tokensUsed: response.usage };
}, { connection });</code></pre>
                </div>

                <h3 id="phase-6">Phase 6: Caching Strategies for Cost Optimization</h3>
                <p>Caching AI responses is one of the most impactful ways to reduce costs. Use Redis/Upstash to cache identical or similar queries:</p>

                <div class="code-block">
                    <div class="code-header">
                        <span class="code-lang">TypeScript</span>
                        <button class="code-copy-btn" aria-label="Copy code">Copy</button>
                    </div>
                    <pre><code><span class="comment">// lib/ai/cache.ts - AI Response Caching</span>
<span class="keyword">import</span> { Redis } <span class="keyword">from</span> <span class="string">'@upstash/redis'</span>;
<span class="keyword">import</span> crypto <span class="keyword">from</span> <span class="string">'crypto'</span>;

<span class="keyword">const</span> redis = <span class="keyword">new</span> Redis({
  url: process.env.UPSTASH_REDIS_URL!,
  token: process.env.UPSTASH_REDIS_TOKEN!,
});

<span class="comment">// Cache TTL in seconds (24 hours for most responses)</span>
<span class="keyword">const</span> CACHE_TTL = <span class="number">86400</span>;

<span class="comment">// Generate a cache key from the prompt and context</span>
<span class="keyword">function</span> <span class="function">generateCacheKey</span>(
  prompt: <span class="variable">string</span>,
  model: <span class="variable">string</span>,
  context?: <span class="variable">string</span>
): <span class="variable">string</span> {
  <span class="keyword">const</span> input = <span class="string">`${model}:${prompt}:${context || ''}`</span>;
  <span class="keyword">return</span> <span class="string">`ai:cache:${crypto.createHash('sha256').update(input).digest('hex')}`</span>;
}

<span class="comment">// Check cache before calling AI</span>
<span class="keyword">export async function</span> <span class="function">getCachedResponse</span>(
  prompt: <span class="variable">string</span>,
  model: <span class="variable">string</span>,
  context?: <span class="variable">string</span>
): <span class="keyword">Promise</span>&lt;<span class="variable">string</span> | <span class="keyword">null</span>&gt; {
  <span class="keyword">const</span> key = generateCacheKey(prompt, model, context);
  <span class="keyword">return</span> <span class="keyword">await</span> redis.get(key);
}

<span class="comment">// Store response in cache</span>
<span class="keyword">export async function</span> <span class="function">cacheResponse</span>(
  prompt: <span class="variable">string</span>,
  model: <span class="variable">string</span>,
  response: <span class="variable">string</span>,
  context?: <span class="variable">string</span>,
  ttl: <span class="variable">number</span> = CACHE_TTL
): <span class="keyword">Promise</span>&lt;<span class="variable">void</span>&gt; {
  <span class="keyword">const</span> key = generateCacheKey(prompt, model, context);
  <span class="keyword">await</span> redis.setex(key, ttl, response);
}

<span class="comment">// Wrapper that handles caching automatically</span>
<span class="keyword">export async function</span> <span class="function">withCache</span>&lt;T&gt;(
  cacheKey: { prompt: <span class="variable">string</span>; model: <span class="variable">string</span>; context?: <span class="variable">string</span> },
  fetchFn: () =&gt; <span class="keyword">Promise</span>&lt;T&gt;,
  options: { ttl?: <span class="variable">number</span>; skipCache?: <span class="variable">boolean</span> } = {}
): <span class="keyword">Promise</span>&lt;T & { cached: <span class="variable">boolean</span> }&gt; {
  <span class="keyword">if</span> (!options.skipCache) {
    <span class="keyword">const</span> cached = <span class="keyword">await</span> getCachedResponse(
      cacheKey.prompt,
      cacheKey.model,
      cacheKey.context
    );
    <span class="keyword">if</span> (cached) {
      <span class="keyword">return</span> { ...JSON.parse(cached), cached: <span class="keyword">true</span> };
    }
  }

  <span class="keyword">const</span> result = <span class="keyword">await</span> fetchFn();

  <span class="keyword">await</span> cacheResponse(
    cacheKey.prompt,
    cacheKey.model,
    JSON.stringify(result),
    cacheKey.context,
    options.ttl
  );

  <span class="keyword">return</span> { ...result, cached: <span class="keyword">false</span> };
}</code></pre>
                </div>

                <div class="callout callout-tip">
                    <div class="callout-title">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M12 2v4M12 18v4M4.93 4.93l2.83 2.83M16.24 16.24l2.83 2.83M2 12h4M18 12h4M4.93 19.07l2.83-2.83M16.24 7.76l2.83-2.83"/></svg>
                        Cost Optimization Strategies
                    </div>
                    <p><strong>Cache hit rates of 30-50%</strong> are common for SaaS products with repeated queries. Combined with model tiering (Haiku for simple tasks, Sonnet for complex), you can reduce AI costs by 60-80%.</p>
                </div>

                <p>Key caching strategies that work for any SaaS:</p>
                <ul>
                    <li><strong>Semantic caching:</strong> Cache similar queries, not just identical ones. Use embeddings to find semantically similar prompts.</li>
                    <li><strong>Context-aware caching:</strong> Include relevant context (user tier, date range, etc.) in the cache key for personalized but cacheable responses.</li>
                    <li><strong>Tiered TTLs:</strong> Use shorter TTLs (1 hour) for dynamic content, longer TTLs (24+ hours) for factual or reference content.</li>
                    <li><strong>Cache warming:</strong> Pre-generate responses for common queries during off-peak hours.</li>
                </ul>

                <!-- Section: Common Issues -->
                <h2 id="common-issues">Common Issues and Solutions</h2>
                <p>Here are some common issues you might encounter and how to solve them:</p>

                <div class="callout callout-warning">
                    <div class="callout-title">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>
                        Streaming Timeout on Vercel
                    </div>
                    <p>Vercel Edge Functions have a 30-second timeout. For long-running AI responses, use <code>export const runtime = 'edge'</code> which allows streaming up to 30 seconds, or move to background jobs for content generation tasks.</p>
                </div>

                <h3 id="issue-context">Context Window Management</h3>
                <p>When conversations get long, you'll hit context limits. Implement a sliding window or summarization strategy:</p>

                <div class="code-block">
                    <div class="code-header">
                        <span class="code-lang">TypeScript</span>
                        <button class="code-copy-btn" aria-label="Copy code">Copy</button>
                    </div>
                    <pre><code><span class="comment">// Trim conversation history to fit context window</span>
<span class="keyword">function</span> <span class="function">trimConversation</span>(
  messages: ChatMessage[],
  maxTokens: <span class="variable">number</span> = <span class="number">100000</span>
): ChatMessage[] {
  <span class="keyword">let</span> tokenCount = <span class="number">0</span>;
  <span class="keyword">const</span> trimmed: ChatMessage[] = [];

  <span class="comment">// Always keep system message</span>
  <span class="keyword">const</span> system = messages.find(m =&gt; m.role === <span class="string">'system'</span>);
  <span class="keyword">if</span> (system) trimmed.push(system);

  <span class="comment">// Add messages from most recent, respecting token limit</span>
  <span class="keyword">for</span> (<span class="keyword">const</span> msg <span class="keyword">of</span> messages.reverse()) {
    <span class="keyword">const</span> msgTokens = estimateTokens(msg.content);
    <span class="keyword">if</span> (tokenCount + msgTokens > maxTokens) <span class="keyword">break</span>;
    <span class="keyword">if</span> (msg.role !== <span class="string">'system'</span>) {
      trimmed.unshift(msg);
      tokenCount += msgTokens;
    }
  }

  <span class="keyword">return</span> trimmed;
}</code></pre>
                </div>

                <h3 id="issue-cost">Controlling AI Costs</h3>
                <p>AI costs can spiral quickly. Combine rate limiting (Phase 4) with caching (Phase 6) for maximum savings:</p>
                <ul>
                    <li><strong>Hard limits per organization:</strong> Stop AI access when monthly spend exceeds plan limit</li>
                    <li><strong>Model tiering:</strong> Use Claude Haiku or GPT-4o-mini for simple tasks, reserve Opus for complex analysis</li>
                    <li><strong>Response caching:</strong> See Phase 6 for detailed caching patterns - aim for 30-50% cache hit rates</li>
                    <li><strong>Alert thresholds:</strong> Notify admins when usage hits 80% of limits</li>
                </ul>

                <!-- Section: Next Steps -->
                <h2 id="next-steps">Next Steps</h2>
                <p>You now have a solid foundation for AI integration. Here's how to expand:</p>

                <ul>
                    <li><strong>Add RAG (Retrieval-Augmented Generation):</strong> Connect a vector database like Pinecone or pgvector to give AI access to your product's knowledge base</li>
                    <li><strong>Implement AI Agents:</strong> Allow AI to take actions in your app (create tasks, update records) with proper permission guards</li>
                    <li><strong>Build Custom Fine-Tuning:</strong> Use OpenAI's fine-tuning API to create models specialized for your domain</li>
                    <li><strong>Add Voice Interface:</strong> Integrate Whisper for voice input and ElevenLabs for AI-generated audio responses</li>
                    <li><strong>Create AI Marketplace:</strong> Let users create and share custom AI prompts/workflows within your platform</li>
                </ul>

                <div class="callout callout-tip">
                    <div class="callout-title">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M12 2v4M12 18v4M4.93 4.93l2.83 2.83M16.24 16.24l2.83 2.83M2 12h4M18 12h4M4.93 19.07l2.83-2.83M16.24 7.76l2.83-2.83"/></svg>
                        Need Help?
                    </div>
                    <p>Adding AI to an existing SaaS product is complex. If you need expert guidance on architecture, implementation, or optimization, reach out for a consultation.</p>
                </div>

                <!-- Share Section -->
                <div class="share-section">
                    <span class="share-label">Share this guide:</span>
                    <div class="share-buttons" role="group" aria-label="Share this guide">
                        <button class="share-btn" data-share="twitter" title="Share on Twitter" aria-label="Share on Twitter">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                                <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
                            </svg>
                        </button>
                        <button class="share-btn" data-share="linkedin" title="Share on LinkedIn" aria-label="Share on LinkedIn">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                                <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
                            </svg>
                        </button>
                        <button class="share-btn" data-share="copy" title="Copy link" aria-label="Copy link to clipboard">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                                <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
                                <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
                            </svg>
                        </button>
                        <button class="share-btn" data-share="email" title="Share via email" aria-label="Share via email">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                                <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
                                <polyline points="22,6 12,13 2,6"></polyline>
                            </svg>
                        </button>
                    </div>
                </div>

                <!-- Related Guides -->
                <div class="related-guides">
                    <h3 class="related-guides-title">Related Guides</h3>
                    <div class="related-guides-grid">
                        <a href="/guides/fintech-ai-dashboard.html" class="related-guide-card">
                            <h4>FinTech AI Dashboard</h4>
                            <p>Build financial analytics with AI insights</p>
                        </a>
                        <a href="/guides/ecommerce-ai-recommender.html" class="related-guide-card">
                            <h4>E-commerce AI Recommender</h4>
                            <p>Product recommendations with Claude</p>
                        </a>
                        <a href="/guides/healthtech-patient-portal.html" class="related-guide-card">
                            <h4>HealthTech Patient Portal</h4>
                            <p>AI-powered health assistant integration</p>
                        </a>
                    </div>
                </div>

                <!-- Follow Section -->
                <div class="follow-section">
                    <h3>Follow the Vibe Coding Enthusiast</h3>
                    <p>Follow JD â€” product updates on LinkedIn, personal takes on X.</p>
                    <div class="social-follow-buttons">
                        <a href="https://www.linkedin.com/in/jeremiahddavid/" target="_blank" rel="noopener noreferrer" class="social-follow-btn linkedin">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg>
                            Follow on LinkedIn
                        </a>
                        <a href="https://x.com/jeremiahddavid" target="_blank" rel="noopener noreferrer" class="social-follow-btn twitter">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
                            Follow on X
                        </a>
                    </div>
                </div>
            </article>
        </div>
    </main>

    <!-- Back to Top Button -->
    <button class="back-to-top" id="backToTop" aria-label="Back to top">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
            <path d="M18 15l-6-6-6 6"/>
        </svg>
    </button>

        <footer class="footer">
    <div class="container">
        <div class="footer-simple">
            <div class="footer-brand">
                <a href="/" class="footer-logo">
                    <img src="/favicon.png" alt="Vibe Coding Enthusiast" class="logo-icon" width="28" height="28">
                    <span>Vibe Coding Enthusiast</span>
                </a>
                <p>Free guides for building with AI</p>
            </div>

            <nav class="footer-nav">
                <a href="/guides/">Guides</a>
                <span class="footer-dot">Â·</span>
                <a href="/paths/">Paths</a>
                <span class="footer-dot">Â·</span>
                <a href="/learn/">Learn</a>
                <span class="footer-dot">Â·</span>
                <a href="/tools/">Tools</a>
                <span class="footer-dot">Â·</span>
                <a href="/stacks/">Stacks</a>
                <span class="footer-dot">Â·</span>
                <a href="/#about">About</a>
            </nav>

            <div class="footer-social">
                <a href="https://www.linkedin.com/in/jeremiahddavid/" target="_blank" rel="noopener noreferrer" aria-label="Follow on LinkedIn">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg>
                </a>
                <a href="https://x.com/jeremiahddavid" target="_blank" rel="noopener noreferrer" aria-label="Follow on X">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
                </a>
            </div>
        </div>

        <div class="footer-bottom">
            <p>Â© 2025 Vibe Coding Enthusiast</p>
            <div class="footer-legal">
                <a href="/privacy.html">Privacy</a>
                <a href="/terms.html">Terms</a>
            </div>
        </div>
    </div>
</footer>

    <script src="/script.js"></script>

    <!-- Guide-Specific JavaScript -->
    <script>
        // Reading Progress Bar
        (function() {
            const progressBar = document.getElementById('readingProgress');
            const article = document.querySelector('.article-content');

            if (progressBar && article) {
                window.addEventListener('scroll', function() {
                    const articleTop = article.offsetTop;
                    const articleHeight = article.offsetHeight;
                    const windowHeight = window.innerHeight;
                    const scrollTop = window.scrollY;

                    const progress = Math.min(100, Math.max(0,
                        ((scrollTop - articleTop + windowHeight * 0.3) / articleHeight) * 100
                    ));

                    progressBar.style.width = progress + '%';
                    progressBar.setAttribute('aria-valuenow', Math.round(progress));
                });
            }
        })();

        // Generate Table of Contents
        (function() {
            const article = document.querySelector('.article-content');
            const tocList = document.getElementById('tocList');

            if (article && tocList) {
                const headings = article.querySelectorAll('h2, h3');
                let tocHTML = '';

                headings.forEach(function(heading) {
                    const id = heading.getAttribute('id');
                    const text = heading.textContent.replace(/#/g, '').trim();
                    const level = heading.tagName.toLowerCase();
                    const className = level === 'h3' ? 'toc-h3' : '';

                    if (id) {
                        tocHTML += '<li><a href="#' + id + '" class="' + className + '">' + text + '</a></li>';

                        // Add anchor link to heading
                        const anchor = document.createElement('a');
                        anchor.href = '#' + id;
                        anchor.className = 'anchor-link';
                        anchor.setAttribute('aria-label', 'Link to ' + text);
                        anchor.textContent = '#';
                        heading.appendChild(anchor);
                    }
                });

                tocList.innerHTML = tocHTML;

                // Highlight active TOC item on scroll
                const tocLinks = tocList.querySelectorAll('a');

                function updateActiveTOC() {
                    const scrollPos = window.scrollY + 120;

                    headings.forEach(function(heading, index) {
                        const id = heading.getAttribute('id');
                        const headingTop = heading.offsetTop;
                        const nextHeading = headings[index + 1];
                        const nextTop = nextHeading ? nextHeading.offsetTop : document.body.scrollHeight;

                        if (scrollPos >= headingTop && scrollPos < nextTop) {
                            tocLinks.forEach(function(link) {
                                link.classList.remove('active');
                                if (link.getAttribute('href') === '#' + id) {
                                    link.classList.add('active');
                                }
                            });
                        }
                    });
                }

                window.addEventListener('scroll', updateActiveTOC);
                updateActiveTOC();
            }
        })();

        // Copy Code Button
        (function() {
            const copyButtons = document.querySelectorAll('.code-copy-btn');

            copyButtons.forEach(function(button) {
                button.addEventListener('click', function() {
                    const codeBlock = this.closest('.code-block');
                    const code = codeBlock.querySelector('code');
                    const text = code.textContent;

                    navigator.clipboard.writeText(text).then(function() {
                        button.textContent = 'Copied!';
                        button.classList.add('copied');

                        setTimeout(function() {
                            button.textContent = 'Copy';
                            button.classList.remove('copied');
                        }, 2000);
                    }).catch(function(err) {
                        console.error('Failed to copy:', err);
                    });
                });
            });
        })();

        // Share Buttons
        (function() {
            const shareButtons = document.querySelectorAll('.share-btn');
            const pageTitle = document.title;
            const pageUrl = window.location.href;

            shareButtons.forEach(function(button) {
                button.addEventListener('click', function() {
                    const shareType = this.getAttribute('data-share');
                    let shareUrl = '';

                    switch(shareType) {
                        case 'twitter':
                            shareUrl = 'https://twitter.com/intent/tweet?text=' + encodeURIComponent(pageTitle) + '&url=' + encodeURIComponent(pageUrl);
                            window.open(shareUrl, '_blank', 'width=550,height=420');
                            break;
                        case 'linkedin':
                            shareUrl = 'https://www.linkedin.com/sharing/share-offsite/?url=' + encodeURIComponent(pageUrl);
                            window.open(shareUrl, '_blank', 'width=550,height=420');
                            break;
                        case 'copy':
                            navigator.clipboard.writeText(pageUrl).then(function() {
                                // Show feedback
                                const originalTitle = button.getAttribute('title');
                                button.setAttribute('title', 'Link copied!');
                                setTimeout(function() {
                                    button.setAttribute('title', originalTitle);
                                }, 2000);
                            });
                            break;
                        case 'email':
                            shareUrl = 'mailto:?subject=' + encodeURIComponent(pageTitle) + '&body=' + encodeURIComponent('Check out this guide: ' + pageUrl);
                            window.location.href = shareUrl;
                            break;
                    }
                });
            });
        })();
    </script>
</body>
</html>
